function renderPersonItem(){peopleDataLocal.forEach(function(e,a){peopleName[a].dataset.name=e.name,peopleName[a].innerHTML=e.name,peopleName[a].parentElement.classList.add("people-list__item-wrapper--show"),peopleName[a].parentElement.classList.remove("people-list__item-wrapper--fade"),searchInput.value="",searchInput.classList.remove("header__input--no-results")})}function renderPlanetItem(){var e=document.querySelectorAll(".people-list__planet");peopleDataLocal.forEach(function(a,t){var n=getPersonPlanetName(a.planet);e[t].innerHTML=n,e[t].dataset.planet=n})}function getPersonPlanetName(e){var a="";return planetDataLocal.forEach(function(t){t.id!==parseInt(e)||(a=t.name)}),a}function requestSWInfo(e,a){return new Promise(function(t,n){var o=new XMLHttpRequest;o.open(a,e,!0),o.send(),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var e=o.responseText,a=JSON.parse(e);t(a)}else n(o.status),console.log("xhr failed");else console.log("xhr processing going on")}})}function errorHandler(e){console.log("failed with status",status)}function reflect(e){return e.then(function(e){return{resolved:e,status:"resolved"}},function(e){return{rejected:e,status:"rejected"}})}function getPlanetData(){function e(e){for(var o=1;o<=e;o++)currentPlanetURL=s+o,i.push(requestSWInfo(currentPlanetURL,"GET"));Promise.all(i.map(reflect)).then(function(e){a(e),t(),renderPlanetItem(),n()})}function a(e){var a=1;e.forEach(function(e){if(e.resolved){var t={id:a,name:e.resolved.name,terrain:e.resolved.terrain,population:e.resolved.population,diameter:e.resolved.diameter};e.resolved.residents.length?t.residents=e.resolved.residents.map(function(e){return e.replace(/[^0-9]/g,"")}):t.residents="unknown",planetDataLocal.push(t)}a++})}function t(){peopleDataLocal.forEach(function(e){e.planetName=getPersonPlanetName(e.planet)})}function n(){l.classList.add("load-screen--fadeout"),loadGif.classList.add("load-screen__img--moveout"),loadBalloonImg.classList.remove("load-screen__balloon--show"),setTimeout(function(){r.classList.add("main--show")},1e3),setTimeout(function(){o.forEach(function(e){e.classList.add("people-list__item-wrapper--show-items")})},1200)}var o=document.querySelectorAll(".people-list__item-wrapper"),r=document.querySelector(".main"),l=document.querySelector(".load-screen"),s="https://swapi.co/api/planets/",i=[];requestSWInfo(s,"GET").then(function(a){e(a.count)},errorHandler)}var loadBalloonImg=document.querySelector(".load-screen__balloon"),loadGif=document.querySelector(".load-screen__img"),searchInput=document.querySelector(".header__input"),peopleGrid=document.querySelector(".people-list__grid"),peopleDataLocal=[],planetDataLocal=[],peopleName,peopleWrapper,modal=function(){function e(e,a,t,n){return'<div class="modal__card"><div class="modal__close-btn"></div><div class="modal__side-img '+e+'"></div><div class="modal__card-info"><div class="modal__card-subject"><p class="modal__card-title">'+a+'</p><span class="modal__card-subtitle">'+t+'</span></div><ul class="modal__info-grid">'+n+"</ul></div></div>"}function a(){var e="";return Array.prototype.slice.call(arguments).forEach(function(a){e+='<li class="modal__info-item"><span class="modal__info-item-key">'+a.key+'</span><span class="modal__info-item-value">'+a.value+"</span></li>"}),e}var t=document.querySelector(".modal");peopleGrid.addEventListener("click",function(n){n.target!==n.currentTarget&&n.target.classList.contains("people-list__value")&&(n.target.dataset.name?peopleDataLocal.forEach(function(o){if(o.name===n.target.dataset.name){var r=o.name,l='Planet</span><span class="modal__card-subtitle modal__card-planet">'+o.planetName,s=a({key:"ID:",value:o.id},{key:"Gender:",value:o.gender},{key:"Birth Year:",value:o.birth_year},{key:"Height:",value:o.height+" cm"},{key:"Mass:",value:o.mass+" Kg"});t.innerHTML=e("modal__side-img--people",r,l,s),t.classList.add("modal-show")}}):planetDataLocal.forEach(function(o){if(o.name===n.target.dataset.planet){var r=o.name,l=a({key:"ID:",value:o.id},{key:"Terrain:",value:o.terrain},{key:"Population:",value:o.population},{key:"Diameter:",value:o.diameter+" Km"},{key:"Residents:",value:o.residents});t.innerHTML=e("modal__side-img--planet",r,"",l),t.classList.add("modal-show")}})),n.stopPropagation()},!1)}(),renderList=function(){function e(e){for(var a=1;a<e;a+=2){var t=n.cloneNode(!0);peopleGrid.appendChild(t)}peopleName=document.querySelectorAll(".people-list__name"),peopleWrapper=document.querySelectorAll(".people-list__item-wrapper")}function a(e){for(var a=1;a<=e;a++)currentPersonURL=o+a,r.push(requestSWInfo(currentPersonURL,"GET"));Promise.all(r.map(reflect)).then(function(e){t(e),renderPersonItem(),getPlanetData()})}function t(e){var a=1;e.forEach(function(e){if(e.resolved){var t={id:a,name:e.resolved.name,height:e.resolved.height,mass:e.resolved.mass,birth_year:e.resolved.birth_year,gender:e.resolved.gender};e.resolved.homeworld?t.planet=e.resolved.homeworld.replace(/[^0-9]/g,""):t.planet="Unknown",e.resolved.species[0]?t.species=e.resolved.species[0].replace(/[^0-9]/g,""):t.species="Unknown",peopleDataLocal.push(t)}a++})}var n=document.querySelector(".people-list__item"),o="https://swapi.co/api/people/",r=[];document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){loadGif.classList.add("load-screen__img--movein")},200),setTimeout(function(){loadBalloonImg.classList.add("load-screen__balloon--show")},2200)}),requestSWInfo(o,"GET").then(function(t){var n=t.count;e(n),a(n)},errorHandler)}(),search=function(){function e(){term=searchInput.value;var e=0,a=new RegExp(term,"gi");peopleWrapper.forEach(function(t){t.children[0].dataset.name&&(t.children[0].dataset.name.match(a)||t.children[1].dataset.planet.match(a)?(e++,t.classList.add("people-list__item-wrapper--show"),setTimeout(function(){t.classList.remove("people-list__item-wrapper--fade")},200)):(t.classList.add("people-list__item-wrapper--fade"),setTimeout(function(){t.classList.remove("people-list__item-wrapper--show")},200)))}),0===e?searchInput.classList.add("header__input--no-results"):searchInput.classList.remove("header__input--no-results")}document.querySelectorAll(".people-list__planet");searchInput.addEventListener("change",e),searchInput.addEventListener("keyup",e)}(),sortPeople=function(){var e=document.querySelector(".header__select");e.addEventListener("change",function(){!function(e){peopleDataLocal.sort(function(a,t){return a[e]<t[e]?-1:a[e]>t[e]?1:0})}(e.value),renderPersonItem(),renderPlanetItem()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9tYWluLmpzIiwicGxhbmV0LWxpc3QuanMiLCJtb2RhbC5qcyIsInBlb3BsZS1saXN0LmpzIiwic2VhcmNoLmpzIiwic29ydFBlb3BsZS5qcyJdLCJuYW1lcyI6WyJyZW5kZXJQZXJzb25JdGVtIiwicGVvcGxlRGF0YUxvY2FsIiwiZm9yRWFjaCIsInBlcnNvbiIsImluZGV4IiwicGVvcGxlTmFtZSIsImRhdGFzZXQiLCJuYW1lIiwiaW5uZXJIVE1MIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInNlYXJjaElucHV0IiwidmFsdWUiLCJyZW5kZXJQbGFuZXRJdGVtIiwicGxhbmV0TmFtZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInBlcnNvblBsYW5ldCIsImdldFBlcnNvblBsYW5ldE5hbWUiLCJwbGFuZXQiLCJwbGFuZXRJZCIsIm15UGxhbmV0IiwicGxhbmV0RGF0YUxvY2FsIiwiaWQiLCJwYXJzZUludCIsInJlcXVlc3RTV0luZm8iLCJ1cmwiLCJtZXRob2RUeXBlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3AiLCJyZXNwb25zZVRleHQiLCJyZXNwSnNvbiIsIkpTT04iLCJwYXJzZSIsImNvbnNvbGUiLCJsb2ciLCJlcnJvckhhbmRsZXIiLCJzdGF0dXNDb2RlIiwicmVmbGVjdCIsInByb21pc2UiLCJ0aGVuIiwicmVzb2x2ZWQiLCJyZWplY3RlZCIsImdldFBsYW5ldERhdGEiLCJfcG9wdWxhdGVMaXN0IiwicGxhbmV0TnVtYmVyIiwiaSIsImN1cnJlbnRQbGFuZXRVUkwiLCJwbGFuZXRVUkwiLCJwcm9taXNlcyIsInB1c2giLCJhbGwiLCJtYXAiLCJwbGFuZXRzRGF0YSIsIl9zdG9yZVBsYW5ldERhdGEiLCJfc2V0UGxhbmV0TmFtZVRvUGVvcGxlIiwiX3N0YXJ0QW5pbWF0aW9uIiwicGxhbmV0RGF0YSIsIm5ld1BsYW5ldCIsInRlcnJhaW4iLCJwb3B1bGF0aW9uIiwiZGlhbWV0ZXIiLCJyZXNpZGVudHMiLCJsZW5ndGgiLCJyZXNpZGVudFVSTCIsInJlcGxhY2UiLCJsb2FkU2NyZWVuIiwibG9hZEdpZiIsImxvYWRCYWxsb29uSW1nIiwic2V0VGltZW91dCIsIm1haW4iLCJpdGVtV3JhcHBlciIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGF0YSIsImNvdW50IiwicGVvcGxlR3JpZCIsInBlb3BsZVdyYXBwZXIiLCJtb2RhbCIsIl9nZXRNb2RhbEhUTUwiLCJpbWdDbGFzcyIsInRpdGxlIiwic3VidGl0bGUiLCJkYXRhTGlzdCIsIl9nZXREYXRhTGlzdEhUTUwiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsImVsIiwia2V5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0IiwiY29udGFpbnMiLCJnZW5kZXIiLCJiaXJ0aF95ZWFyIiwiaGVpZ2h0IiwibWFzcyIsInN0b3BQcm9wYWdhdGlvbiIsInJlbmRlckxpc3QiLCJfYnVpbGRMaXN0IiwicGVvcGxlTnVtYmVyIiwicGVvcGxlTGlDbG9uZSIsInBlb3BsZUxpIiwiY2xvbmVOb2RlIiwiYXBwZW5kQ2hpbGQiLCJjdXJyZW50UGVyc29uVVJMIiwicGVvcGxlVVJMIiwicGVvcGxlRGF0YSIsIl9zdG9yZVBlb3BsZURhdGEiLCJwZXJzb25EYXRhIiwibmV3UGVyc29uIiwiaG9tZXdvcmxkIiwic3BlY2llcyIsInNlYXJjaCIsIl9maWx0ZXJNYXRjaGVzIiwidGVybSIsIm1hdGNoRmxhZyIsInJlZ2V4IiwiUmVnRXhwIiwicGVyc29uV3JhcHBlciIsImNoaWxkcmVuIiwibWF0Y2giLCJzb3J0UGVvcGxlIiwic2VjdFR5cGUiLCJwcm9wZXJ0eSIsInNvcnQiLCJhIiwiYiIsIl9zb3J0QnkiXSwibWFwcGlu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TUFBQUosSUFBQUUsRUFBQUMsU0FBQSxHQUFBakksUUFBQWUsT0FBQW1ILE1BQUFKLElBQ0FELElBQ0FHLEVBQUE1SCxVQUFBQyxJQUFBLG1DQUNBcUUsV0FBQSxXQUNBc0QsRUFBQTVILFVBQUFFLE9BQUEsb0NBQ0EsT0FFQTBILEVBQUE1SCxVQUFBQyxJQUFBLG1DQUNBcUUsV0FBQSxXQUNBc0QsRUFBQTVILFVBQUFFLE9BQUEsb0NBQ0EsU0FJQSxJQUFBdUgsRUFBQXRILFlBQUFILFVBQUFDLElBQUEsNkJBQUFFLFlBQUFILFVBQUFFLE9BQUEsNkJBekJBSyxTQUFBQyxpQkFBQSx3QkFFQUwsWUFBQTBGLGlCQUFBLFNBQUEwQixHQUNBcEgsWUFBQTBGLGlCQUFBLFFBQUEwQixHQUpBLEdDQUFRLFdBQUEsV0FDQSxJQUFBQyxFQUFBekgsU0FBQW1FLGNBQUEsbUJBRUFzRCxFQUFBbkMsaUJBQUEsU0FFQSxZQUtBLFNBQUFvQyxHQUNBMUksZ0JBQUEySSxLQUFBLFNBQUFDLEVBQUFDLEdBQ0EsT0FBQUQsRUFBQUYsR0FBQUcsRUFBQUgsSUFBQSxFQUNBRSxFQUFBRixHQUFBRyxFQUFBSCxHQUFBLEVBQ0EsSUFSQUksQ0FBQUwsRUFBQTVILE9BQ0FkLG1CQUNBZSxxQkFSQSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbG9hZEJhbGxvb25JbWcgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxvYWQtc2NyZWVuX19iYWxsb29uJyk7XG52YXIgbG9hZEdpZiAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxvYWQtc2NyZWVuX19pbWcnKTtcbnZhciBzZWFyY2hJbnB1dCAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19pbnB1dCcpO1xudmFyIHBlb3BsZUdyaWQgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wZW9wbGUtbGlzdF9fZ3JpZCcpO1xudmFyIHBlb3BsZURhdGFMb2NhbCA9IFtdO1xudmFyIHBsYW5ldERhdGFMb2NhbCA9IFtdO1xudmFyIHBlb3BsZU5hbWU7IC8vIGhvbGQgcGVvcGxlIGxpc3QgbmFtZSBET00gZWxcbnZhciBwZW9wbGVXcmFwcGVyOyAvLyBob2xkIHBlb3BsZSBsaXN0IHdyYXBwZXIgRE9NIGVsXG5cbmZ1bmN0aW9uIHJlbmRlclBlcnNvbkl0ZW0oKSB7XG4gIHBlb3BsZURhdGFMb2NhbC5mb3JFYWNoKCBmdW5jdGlvbihwZXJzb24sIGluZGV4KSB7XG4gICAgcGVvcGxlTmFtZVtpbmRleF0uZGF0YXNldC5uYW1lID0gcGVyc29uLm5hbWU7XG4gICAgcGVvcGxlTmFtZVtpbmRleF0uaW5uZXJIVE1MID0gcGVyc29uLm5hbWU7XG4gICAgcGVvcGxlTmFtZVtpbmRleF0ucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1zaG93Jyk7XG4gICAgcGVvcGxlTmFtZVtpbmRleF0ucGFyZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1mYWRlJyk7XG4gICAgc2VhcmNoSW5wdXQudmFsdWUgPSBcIlwiO1xuICAgIHNlYXJjaElucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hlYWRlcl9faW5wdXQtLW5vLXJlc3VsdHMnKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlclBsYW5ldEl0ZW0oKSB7XG4gIHZhciBwbGFuZXROYW1lICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW9wbGUtbGlzdF9fcGxhbmV0Jyk7XG5cbiAgcGVvcGxlRGF0YUxvY2FsLmZvckVhY2goIGZ1bmN0aW9uKHBlcnNvbiwgaW5kZXgpIHtcbiAgICB2YXIgcGVyc29uUGxhbmV0ID0gZ2V0UGVyc29uUGxhbmV0TmFtZShwZXJzb24ucGxhbmV0KTtcbiAgICBwbGFuZXROYW1lW2luZGV4XS5pbm5lckhUTUwgPSBwZXJzb25QbGFuZXQ7XG4gICAgcGxhbmV0TmFtZVtpbmRleF0uZGF0YXNldC5wbGFuZXQgPSBwZXJzb25QbGFuZXQ7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRQZXJzb25QbGFuZXROYW1lKHBsYW5ldElkKSB7XG4gIHZhciBteVBsYW5ldCA9ICcnO1xuICBwbGFuZXREYXRhTG9jYWwuZm9yRWFjaChmdW5jdGlvbihwbGFuZXQpIHtcbiAgICBpZiAocGxhbmV0LmlkID09PSBwYXJzZUludChwbGFuZXRJZCkpIHtcbiAgICAgIG15UGxhbmV0ID0gcGxhbmV0Lm5hbWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG15UGxhbmV0O1xufVxuXG5mdW5jdGlvbiByZXF1ZXN0U1dJbmZvKHVybCwgbWV0aG9kVHlwZSl7XG4gIHZhciBwcm9taXNlT2JqID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KXtcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgeGhyLm9wZW4obWV0aG9kVHlwZSwgdXJsLCB0cnVlKTtcbiAgICB4aHIuc2VuZCgpO1xuICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpe1xuICAgICAgaWYoeGhyLnJlYWR5U3RhdGUgPT09IDQpe1xuICAgICAgICAgaWYoeGhyLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgICB2YXIgcmVzcCA9IHhoci5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgICB2YXIgcmVzcEpzb24gPSBKU09OLnBhcnNlKHJlc3ApO1xuICAgICAgICAgICAgcmVzb2x2ZShyZXNwSnNvbik7XG4gICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICByZWplY3QoeGhyLnN0YXR1cyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInhociBmYWlsZWRcIik7IC8vIFRPRE86IGFwcGVuZCAnY2FudCBmaW5kJyBtc2dcbiAgICAgICAgICAgfVxuICAgICAgfSBlbHNle1xuICAgICAgICAgY29uc29sZS5sb2coXCJ4aHIgcHJvY2Vzc2luZyBnb2luZyBvblwiKTsgLy8gVE9ETzogYWRkIGxvYWRpbmcgYW5pbWF0aW9uXG4gICAgICAgICB9XG4gICAgfTtcbiAgfSk7XG4gIHJldHVybiBwcm9taXNlT2JqO1xufVxuXG5mdW5jdGlvbiBlcnJvckhhbmRsZXIoc3RhdHVzQ29kZSl7XG4gIGNvbnNvbGUubG9nKFwiZmFpbGVkIHdpdGggc3RhdHVzXCIsIHN0YXR1cyk7XG59XG5cbmZ1bmN0aW9uIHJlZmxlY3QocHJvbWlzZSl7XG4gIHJldHVybiBwcm9taXNlLnRoZW4oZnVuY3Rpb24ocmVzb2x2ZWQpeyByZXR1cm4ge3Jlc29sdmVkOnJlc29sdmVkLCBzdGF0dXM6IFwicmVzb2x2ZWRcIiB9O30sXG4gICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVqZWN0ZWQpeyByZXR1cm4ge3JlamVjdGVkOnJlamVjdGVkLCBzdGF0dXM6IFwicmVqZWN0ZWRcIiB9O30pO1xufVxuIiwiZnVuY3Rpb24gZ2V0UGxhbmV0RGF0YSgpe1xuICB2YXIgaXRlbVdyYXBwZXIgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlcicpO1xuICB2YXIgbWFpbiAgICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbicpO1xuICB2YXIgbG9hZFNjcmVlbiAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZC1zY3JlZW4nKTtcbiAgdmFyIHBsYW5ldFVSTCAgICAgID0gJ2h0dHBzOi8vc3dhcGkuY28vYXBpL3BsYW5ldHMvJztcbiAgdmFyIHByb21pc2VzICAgICAgID0gW107XG5cbiAgcmVxdWVzdFNXSW5mbyhwbGFuZXRVUkwsIFwiR0VUXCIpLnRoZW4oX3N0YXJ0TGlzdCwgZXJyb3JIYW5kbGVyKTtcblxuICBmdW5jdGlvbiBfc3RhcnRMaXN0KGRhdGEpIHtcbiAgICB2YXIgcGxhbmV0TnVtYmVyID0gZGF0YS5jb3VudDtcbiAgICBfcG9wdWxhdGVMaXN0KHBsYW5ldE51bWJlcik7XG4gIH1cblxuICBmdW5jdGlvbiBfcG9wdWxhdGVMaXN0KHBsYW5ldE51bWJlcikge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IHBsYW5ldE51bWJlcjsgaSsrKSB7XG4gICAgICBjdXJyZW50UGxhbmV0VVJMID0gcGxhbmV0VVJMICsgaTtcbiAgICAgIHByb21pc2VzLnB1c2gocmVxdWVzdFNXSW5mbyhjdXJyZW50UGxhbmV0VVJMLCBcIkdFVFwiKSk7XG4gICAgfVxuICAgIFByb21pc2UuYWxsKHByb21pc2VzLm1hcChyZWZsZWN0KSkudGhlbihmdW5jdGlvbihwbGFuZXRzRGF0YSl7XG4gICAgICBfc3RvcmVQbGFuZXREYXRhKHBsYW5ldHNEYXRhKTtcbiAgICAgIF9zZXRQbGFuZXROYW1lVG9QZW9wbGUoKTtcbiAgICAgIHJlbmRlclBsYW5ldEl0ZW0oKTtcbiAgICAgIF9zdGFydEFuaW1hdGlvbigpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3N0b3JlUGxhbmV0RGF0YShwbGFuZXRzRGF0YSkge1xuICAgIHZhciBpZCA9IDE7XG4gICAgcGxhbmV0c0RhdGEuZm9yRWFjaChmdW5jdGlvbihwbGFuZXREYXRhKSB7XG4gICAgICBpZiAocGxhbmV0RGF0YS5yZXNvbHZlZCkge1xuICAgICAgICB2YXIgbmV3UGxhbmV0ID0ge1xuICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICBuYW1lOiBwbGFuZXREYXRhLnJlc29sdmVkLm5hbWUsXG4gICAgICAgICAgdGVycmFpbjogcGxhbmV0RGF0YS5yZXNvbHZlZC50ZXJyYWluLFxuICAgICAgICAgIHBvcHVsYXRpb246IHBsYW5ldERhdGEucmVzb2x2ZWQucG9wdWxhdGlvbixcbiAgICAgICAgICBkaWFtZXRlcjogcGxhbmV0RGF0YS5yZXNvbHZlZC5kaWFtZXRlclxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChwbGFuZXREYXRhLnJlc29sdmVkLnJlc2lkZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICBuZXdQbGFuZXQucmVzaWRlbnRzID0gcGxhbmV0RGF0YS5yZXNvbHZlZC5yZXNpZGVudHMubWFwKGZ1bmN0aW9uKHJlc2lkZW50VVJMKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzaWRlbnRVUkwucmVwbGFjZSgvW14wLTldL2csJycpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld1BsYW5ldC5yZXNpZGVudHMgPSBcInVua25vd25cIjtcbiAgICAgICAgfVxuICAgICAgICBwbGFuZXREYXRhTG9jYWwucHVzaChuZXdQbGFuZXQpO1xuICAgICAgfVxuICAgICAgaWQrKztcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zZXRQbGFuZXROYW1lVG9QZW9wbGUoKSB7XG4gICAgcGVvcGxlRGF0YUxvY2FsLmZvckVhY2goZnVuY3Rpb24ocGVyc29uKSB7XG4gICAgICBwZXJzb24ucGxhbmV0TmFtZSA9IGdldFBlcnNvblBsYW5ldE5hbWUocGVyc29uLnBsYW5ldCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RhcnRBbmltYXRpb24oKSB7XG4gICAgbG9hZFNjcmVlbi5jbGFzc0xpc3QuYWRkKCdsb2FkLXNjcmVlbi0tZmFkZW91dCcpO1xuICAgIGxvYWRHaWYuY2xhc3NMaXN0LmFkZCgnbG9hZC1zY3JlZW5fX2ltZy0tbW92ZW91dCcpO1xuICAgIGxvYWRCYWxsb29uSW1nLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWQtc2NyZWVuX19iYWxsb29uLS1zaG93Jyk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIG1haW4uY2xhc3NMaXN0LmFkZCgnbWFpbi0tc2hvdycpO1xuICAgIH0sIDEwMDApO1xuICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGl0ZW1XcmFwcGVyLmZvckVhY2goIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1zaG93LWl0ZW1zJyk7XG4gICAgICB9KTtcbiAgICB9LCAxMjAwKTtcbiAgfVxufVxuIiwidmFyIG1vZGFsID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcblxuICBwZW9wbGVHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2J1aWxkTW9kYWwsIGZhbHNlKTtcblxuICBmdW5jdGlvbiBfYnVpbGRNb2RhbChlKSB7XG4gICAgaWYoZS50YXJnZXQgIT09IGUuY3VycmVudFRhcmdldCAmJiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Blb3BsZS1saXN0X192YWx1ZScpKSB7XG4gICAgICBpZiAoZS50YXJnZXQuZGF0YXNldC5uYW1lKSB7XG4gICAgICAgIHBlb3BsZURhdGFMb2NhbC5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbikge1xuICAgICAgICAgIGlmIChwZXJzb24ubmFtZSA9PT0gZS50YXJnZXQuZGF0YXNldC5uYW1lKSB7XG4gICAgICAgICAgICB2YXIgaW1nQ2xhc3MgPSAnbW9kYWxfX3NpZGUtaW1nLS1wZW9wbGUnO1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gcGVyc29uLm5hbWU7XG4gICAgICAgICAgICB2YXIgc3VidGl0bGUgPSAnUGxhbmV0PC9zcGFuPjxzcGFuIGNsYXNzPVwibW9kYWxfX2NhcmQtc3VidGl0bGUgbW9kYWxfX2NhcmQtcGxhbmV0XCI+JyArIHBlcnNvbi5wbGFuZXROYW1lO1xuICAgICAgICAgICAgdmFyIGRhdGFMaXN0ID0gX2dldERhdGFMaXN0SFRNTCh7a2V5OidJRDonLCB2YWx1ZTpwZXJzb24uaWR9LCB7a2V5OidHZW5kZXI6JywgdmFsdWU6cGVyc29uLmdlbmRlcn0se2tleTonQmlydGggWWVhcjonLCB2YWx1ZTpwZXJzb24uYmlydGhfeWVhcn0se2tleTonSGVpZ2h0OicsIHZhbHVlOnBlcnNvbi5oZWlnaHQgKyAnIGNtJ30sIHtrZXk6J01hc3M6JywgdmFsdWU6IHBlcnNvbi5tYXNzICsgJyBLZyd9KTtcblxuICAgICAgICAgICAgbW9kYWwuaW5uZXJIVE1MID0gX2dldE1vZGFsSFRNTChpbWdDbGFzcywgdGl0bGUsIHN1YnRpdGxlLCBkYXRhTGlzdCk7XG4gICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbC1zaG93Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBsYW5ldERhdGFMb2NhbC5mb3JFYWNoKGZ1bmN0aW9uKHBsYW5ldCkge1xuICAgICAgICAgIGlmIChwbGFuZXQubmFtZSA9PT0gZS50YXJnZXQuZGF0YXNldC5wbGFuZXQpIHtcbiAgICAgICAgICAgIHZhciBpbWdDbGFzcyA9ICdtb2RhbF9fc2lkZS1pbWctLXBsYW5ldCc7XG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBwbGFuZXQubmFtZTtcbiAgICAgICAgICAgIHZhciBzdWJ0aXRsZSA9ICcnO1xuICAgICAgICAgICAgdmFyIGRhdGFMaXN0ID0gX2dldERhdGFMaXN0SFRNTCh7a2V5OidJRDonLCB2YWx1ZTpwbGFuZXQuaWR9LCB7a2V5OidUZXJyYWluOicsIHZhbHVlOnBsYW5ldC50ZXJyYWlufSx7a2V5OidQb3B1bGF0aW9uOicsIHZhbHVlOnBsYW5ldC5wb3B1bGF0aW9ufSx7a2V5OidEaWFtZXRlcjonLCB2YWx1ZTpwbGFuZXQuZGlhbWV0ZXIgKyAnIEttJ30sIHtrZXk6J1Jlc2lkZW50czonLCB2YWx1ZTogcGxhbmV0LnJlc2lkZW50c30pO1xuXG4gICAgICAgICAgICBtb2RhbC5pbm5lckhUTUwgPSBfZ2V0TW9kYWxIVE1MKGltZ0NsYXNzLCB0aXRsZSwgc3VidGl0bGUsIGRhdGFMaXN0KTtcbiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ21vZGFsLXNob3cnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldE1vZGFsSFRNTChpbWdDbGFzcywgdGl0bGUsIHN1YnRpdGxlLCBkYXRhTGlzdCkge1xuICAgIHZhciBtb2RhbEhUTUwgPSAnPGRpdiBjbGFzcz1cIm1vZGFsX19jYXJkXCI+PGRpdiBjbGFzcz1cIm1vZGFsX19jbG9zZS1idG5cIj48L2Rpdj48ZGl2IGNsYXNzPVwibW9kYWxfX3NpZGUtaW1nICcgKyBpbWdDbGFzcyArICdcIj48L2Rpdj48ZGl2IGNsYXNzPVwibW9kYWxfX2NhcmQtaW5mb1wiPjxkaXYgY2xhc3M9XCJtb2RhbF9fY2FyZC1zdWJqZWN0XCI+PHAgY2xhc3M9XCJtb2RhbF9fY2FyZC10aXRsZVwiPicgKyB0aXRsZSArICc8L3A+PHNwYW4gY2xhc3M9XCJtb2RhbF9fY2FyZC1zdWJ0aXRsZVwiPicgKyBzdWJ0aXRsZSArICc8L3NwYW4+PC9kaXY+PHVsIGNsYXNzPVwibW9kYWxfX2luZm8tZ3JpZFwiPicgKyBkYXRhTGlzdCArICc8L3VsPjwvZGl2PjwvZGl2Pic7XG4gICAgcmV0dXJuIG1vZGFsSFRNTDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXREYXRhTGlzdEhUTUwoKXtcbiAgICB2YXIgZGF0YUxpc3QgPSAnJztcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7XG4gICAgICBkYXRhTGlzdCArPSAgJzxsaSBjbGFzcz1cIm1vZGFsX19pbmZvLWl0ZW1cIj48c3BhbiBjbGFzcz1cIm1vZGFsX19pbmZvLWl0ZW0ta2V5XCI+JyArIGVsLmtleSArICc8L3NwYW4+PHNwYW4gY2xhc3M9XCJtb2RhbF9faW5mby1pdGVtLXZhbHVlXCI+JyArIGVsLnZhbHVlICsgJzwvc3Bhbj48L2xpPic7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGFMaXN0O1xuICB9XG59KSgpO1xuIiwidmFyIHJlbmRlckxpc3QgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBwZW9wbGVMaSAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBlb3BsZS1saXN0X19pdGVtJyk7XG5cbiAgdmFyIHBlb3BsZVVSTCA9ICdodHRwczovL3N3YXBpLmNvL2FwaS9wZW9wbGUvJztcbiAgdmFyIHByb21pc2VzID0gW107XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGxvYWRHaWYuY2xhc3NMaXN0LmFkZCgnbG9hZC1zY3JlZW5fX2ltZy0tbW92ZWluJyk7XG4gICAgfSwgMjAwKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgbG9hZEJhbGxvb25JbWcuY2xhc3NMaXN0LmFkZCgnbG9hZC1zY3JlZW5fX2JhbGxvb24tLXNob3cnKTtcbiAgICB9LCAyMjAwKTtcbiAgfSk7XG5cbiAgcmVxdWVzdFNXSW5mbyhwZW9wbGVVUkwsIFwiR0VUXCIpLnRoZW4oX3N0YXJ0TGlzdCwgZXJyb3JIYW5kbGVyKTtcblxuICBmdW5jdGlvbiBfc3RhcnRMaXN0KGRhdGEpIHtcbiAgICB2YXIgcGVvcGxlTnVtYmVyID0gZGF0YS5jb3VudDtcbiAgICBfYnVpbGRMaXN0KHBlb3BsZU51bWJlcik7XG4gICAgX3BvcHVsYXRlTGlzdChwZW9wbGVOdW1iZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2J1aWxkTGlzdChwZW9wbGVOdW1iZXIpIHtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHBlb3BsZU51bWJlcjsgaSs9Mikge1xuICAgICAgdmFyIHBlb3BsZUxpQ2xvbmUgPSBwZW9wbGVMaS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICBwZW9wbGVHcmlkLmFwcGVuZENoaWxkKHBlb3BsZUxpQ2xvbmUpO1xuICAgIH1cbiAgICBwZW9wbGVOYW1lICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlb3BsZS1saXN0X19uYW1lJyk7XG4gICAgcGVvcGxlV3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyJyk7XG4gIH1cblxuICBmdW5jdGlvbiBfcG9wdWxhdGVMaXN0KHBlb3BsZU51bWJlcikge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IHBlb3BsZU51bWJlcjsgaSsrKSB7XG4gICAgICBjdXJyZW50UGVyc29uVVJMID0gcGVvcGxlVVJMICsgaTtcbiAgICAgIHByb21pc2VzLnB1c2gocmVxdWVzdFNXSW5mbyhjdXJyZW50UGVyc29uVVJMLCBcIkdFVFwiKSk7XG4gICAgfVxuICAgIFByb21pc2UuYWxsKHByb21pc2VzLm1hcChyZWZsZWN0KSkudGhlbihmdW5jdGlvbihwZW9wbGVEYXRhKXtcbiAgICAgIF9zdG9yZVBlb3BsZURhdGEocGVvcGxlRGF0YSk7XG4gICAgICByZW5kZXJQZXJzb25JdGVtKCk7XG4gICAgICBnZXRQbGFuZXREYXRhKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RvcmVQZW9wbGVEYXRhKHBlb3BsZURhdGEpIHtcbiAgICB2YXIgaWQgPSAxO1xuICAgIHBlb3BsZURhdGEuZm9yRWFjaChmdW5jdGlvbihwZXJzb25EYXRhKSB7XG4gICAgICBpZiAocGVyc29uRGF0YS5yZXNvbHZlZCkge1xuICAgICAgICB2YXIgbmV3UGVyc29uID0ge1xuICAgICAgICAgIGlkICAgICAgICAgOiBpZCxcbiAgICAgICAgICBuYW1lICAgICAgIDogcGVyc29uRGF0YS5yZXNvbHZlZC5uYW1lLFxuICAgICAgICAgIGhlaWdodCAgICAgOiBwZXJzb25EYXRhLnJlc29sdmVkLmhlaWdodCxcbiAgICAgICAgICBtYXNzICAgICAgIDogcGVyc29uRGF0YS5yZXNvbHZlZC5tYXNzLFxuICAgICAgICAgIGJpcnRoX3llYXIgOiBwZXJzb25EYXRhLnJlc29sdmVkLmJpcnRoX3llYXIsXG4gICAgICAgICAgZ2VuZGVyICAgICA6IHBlcnNvbkRhdGEucmVzb2x2ZWQuZ2VuZGVyXG4gICAgICAgIH07XG4gICAgICAgIHBlcnNvbkRhdGEucmVzb2x2ZWQuaG9tZXdvcmxkID9cbiAgICAgICAgbmV3UGVyc29uLnBsYW5ldCA9IHBlcnNvbkRhdGEucmVzb2x2ZWQuaG9tZXdvcmxkLnJlcGxhY2UoL1teMC05XS9nLCcnKSA6XG4gICAgICAgIG5ld1BlcnNvbi5wbGFuZXQgPSBcIlVua25vd25cIjtcblxuICAgICAgICBwZXJzb25EYXRhLnJlc29sdmVkLnNwZWNpZXNbMF0gP1xuICAgICAgICBuZXdQZXJzb24uc3BlY2llcyA9IHBlcnNvbkRhdGEucmVzb2x2ZWQuc3BlY2llc1swXS5yZXBsYWNlKC9bXjAtOV0vZywnJykgOlxuICAgICAgICBuZXdQZXJzb24uc3BlY2llcyA9IFwiVW5rbm93blwiO1xuXG4gICAgICAgIHBlb3BsZURhdGFMb2NhbC5wdXNoKG5ld1BlcnNvbik7XG4gICAgICB9XG4gICAgICBpZCsrO1xuICAgIH0pO1xuICB9XG59KSgpO1xuIiwidmFyIHNlYXJjaCAgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBwbGFuZXROYW1lICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW9wbGUtbGlzdF9fcGxhbmV0Jyk7XG5cbiAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgX2ZpbHRlck1hdGNoZXMpO1xuICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIF9maWx0ZXJNYXRjaGVzKTtcblxuICBmdW5jdGlvbiBfZmlsdGVyTWF0Y2hlcygpIHtcbiAgICB0ZXJtID0gc2VhcmNoSW5wdXQudmFsdWU7XG4gICAgdmFyIG1hdGNoRmxhZyA9IDA7XG4gICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCh0ZXJtLCAnZ2knKTtcbiAgICBwZW9wbGVXcmFwcGVyLmZvckVhY2goZnVuY3Rpb24ocGVyc29uV3JhcHBlcikge1xuICAgICAgaWYocGVyc29uV3JhcHBlci5jaGlsZHJlblswXS5kYXRhc2V0Lm5hbWUpIHtcbiAgICAgICAgaWYgKHBlcnNvbldyYXBwZXIuY2hpbGRyZW5bMF0uZGF0YXNldC5uYW1lLm1hdGNoKHJlZ2V4KSB8fCBwZXJzb25XcmFwcGVyLmNoaWxkcmVuWzFdLmRhdGFzZXQucGxhbmV0Lm1hdGNoKHJlZ2V4KSkge1xuICAgICAgICAgIG1hdGNoRmxhZysrO1xuICAgICAgICAgICAgcGVyc29uV3JhcHBlci5jbGFzc0xpc3QuYWRkKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1zaG93Jyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBwZXJzb25XcmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Blb3BsZS1saXN0X19pdGVtLXdyYXBwZXItLWZhZGUnKTtcbiAgICAgICAgICB9LCAyMDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwZXJzb25XcmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Blb3BsZS1saXN0X19pdGVtLXdyYXBwZXItLWZhZGUnKTtcbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwZXJzb25XcmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Blb3BsZS1saXN0X19pdGVtLXdyYXBwZXItLXNob3cnKTtcbiAgICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgbWF0Y2hGbGFnID09PSAwID8gc2VhcmNoSW5wdXQuY2xhc3NMaXN0LmFkZCgnaGVhZGVyX19pbnB1dC0tbm8tcmVzdWx0cycpIDogc2VhcmNoSW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnaGVhZGVyX19pbnB1dC0tbm8tcmVzdWx0cycpXG4gIH1cbn0pKCk7XG4iLCJ2YXIgc29ydFBlb3BsZSA9IChmdW5jdGlvbigpIHtcbiAgdmFyIHNlY3RUeXBlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fc2VsZWN0Jyk7XG5cbiAgc2VjdFR5cGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgX3NvcnRQZW9wbGVEYXRhTG9jYWwpO1xuXG4gIGZ1bmN0aW9uIF9zb3J0UGVvcGxlRGF0YUxvY2FsKCkge1xuICAgIF9zb3J0Qnkoc2VjdFR5cGUudmFsdWUpO1xuICAgIHJlbmRlclBlcnNvbkl0ZW0oKTtcbiAgICByZW5kZXJQbGFuZXRJdGVtKCk7XG5cbiAgICBmdW5jdGlvbiBfc29ydEJ5KHByb3BlcnR5KSB7XG4gICAgICBwZW9wbGVEYXRhTG9jYWwuc29ydChmdW5jdGlvbihhLCBiKXtcbiAgICAgICAgaWYoYVtwcm9wZXJ0eV0gPCBiW3Byb3BlcnR5XSkgcmV0dXJuIC0xO1xuICAgICAgICBpZihhW3Byb3BlcnR5XSA+IGJbcHJvcGVydHldKSByZXR1cm4gMTtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn0pKCk7XG5cbiJdfQ==
