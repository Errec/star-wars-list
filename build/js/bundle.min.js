function renderPersonItem(){peopleDataLocal.forEach(function(e,a){peopleName[a].dataset.name=e.name,peopleName[a].innerHTML=e.name,peopleName[a].parentElement.classList.add("people-list__item-wrapper--show"),peopleName[a].parentElement.classList.remove("people-list__item-wrapper--fade"),searchInput.value="",searchInput.classList.remove("header__input--no-results")})}function renderPlanetItem(){var e=document.querySelectorAll(".people-list__planet");peopleDataLocal.forEach(function(a,t){var n=getPersonPlanetName(a.planet);e[t].innerHTML=n,e[t].dataset.planet=n})}function getPersonPlanetName(e){var a="";return planetDataLocal.forEach(function(t){t.id!==parseInt(e)||(a=t.name)}),a}function requestSWInfo(e,a){return new Promise(function(t,n){var o=new XMLHttpRequest;o.open(a,e,!0),o.send(),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var e=o.responseText,a=JSON.parse(e);t(a)}else n(o.status),console.log("xhr failed");else console.log("xhr processing going on")}})}function errorHandler(e){console.log("failed with status",status)}function reflect(e){return e.then(function(e){return{resolved:e,status:"resolved"}},function(e){return{rejected:e,status:"rejected"}})}function getPlanetData(){function e(e){for(var o=1;o<=e;o++)currentPlanetURL=s+o,i.push(requestSWInfo(currentPlanetURL,"GET"));Promise.all(i.map(reflect)).then(function(e){a(e),t(),renderPlanetItem(),n()})}function a(e){var a=1;e.forEach(function(e){if(e.resolved){var t={id:a,name:e.resolved.name,terrain:e.resolved.terrain,population:e.resolved.population,diameter:e.resolved.diameter};e.resolved.residents.length?t.residents=e.resolved.residents.map(function(e){return e.replace(/[^0-9]/g,"")}):t.residents="unknown",planetDataLocal.push(t)}a++})}function t(){peopleDataLocal.forEach(function(e){e.planetName=getPersonPlanetName(e.planet)})}function n(){l.classList.add("load-screen--fadeout"),loadGif.classList.add("load-screen__img--moveout"),loadBalloonImg.classList.remove("load-screen__balloon--show"),setTimeout(function(){r.classList.add("main--show")},1e3),setTimeout(function(){o.forEach(function(e){e.classList.add("people-list__item-wrapper--show-items")})},1200)}var o=document.querySelectorAll(".people-list__item-wrapper"),r=document.querySelector(".main"),l=document.querySelector(".load-screen"),s="https://swapi.co/api/planets/",i=[];requestSWInfo(s,"GET").then(function(a){e(a.count)},errorHandler)}var loadBalloonImg=document.querySelector(".load-screen__balloon"),loadGif=document.querySelector(".load-screen__img"),searchInput=document.querySelector(".header__input"),peopleGrid=document.querySelector(".people-list__grid"),peopleDataLocal=[],planetDataLocal=[],peopleName,peopleWrapper,modal=function(){function e(e,a,t,n){return'<div class="modal__card"><div class="modal__close-btn"></div><div class="modal__side-img '+e+'"></div><div class="modal__card-info"><div class="modal__card-subject"><p class="modal__card-title">'+a+'</p><span class="modal__card-subtitle">'+t+'</span></div><ul class="modal__info-grid">'+n+"</ul></div></div>"}function a(){var e="";return Array.prototype.slice.call(arguments).forEach(function(a){e+='<li class="modal__info-item"><span class="modal__info-item-key">'+a.key+'</span><span class="modal__info-item-value">'+a.value+"</span></li>"}),e}var t=document.querySelector(".modal");peopleGrid.addEventListener("click",function(n){n.target!==n.currentTarget&&n.target.classList.contains("people-list__value")&&(n.target.dataset.name?peopleDataLocal.forEach(function(o){if(o.name===n.target.dataset.name){var r=o.name,l='Planet</span><span class="modal__card-subtitle modal__card-planet">'+o.planetName,s=a({key:"ID:",value:o.id},{key:"Gender:",value:o.gender},{key:"Birth Year:",value:o.birth_year},{key:"Height:",value:o.height+" cm"},{key:"Mass:",value:o.mass+" Kg"});t.innerHTML=e("modal__side-img--people",r,l,s),t.classList.add("modal-show")}}):planetDataLocal.forEach(function(o){if(o.name===n.target.dataset.planet){var r=o.name,l=a({key:"ID:",value:o.id},{key:"Terrain:",value:o.terrain},{key:"Population:",value:o.population},{key:"Diameter:",value:o.diameter+" Km"},{key:"Residents:",value:o.residents});t.innerHTML=e("modal__side-img--planet",r,"",l),t.classList.add("modal-show")}})),n.stopPropagation()},!1),t.addEventListener("click",function(e){e.target&&e.target.classList.contains("modal__close-btn")&&t.classList.remove("modal-show")},!1),window.onclick=function(e){e.target==t&&t.classList.remove("modal-show")}}(),renderList=function(){function e(e){for(var a=1;a<e;a+=2){var t=n.cloneNode(!0);peopleGrid.appendChild(t)}peopleName=document.querySelectorAll(".people-list__name"),peopleWrapper=document.querySelectorAll(".people-list__item-wrapper")}function a(e){for(var a=1;a<=e;a++)currentPersonURL=o+a,r.push(requestSWInfo(currentPersonURL,"GET"));Promise.all(r.map(reflect)).then(function(e){t(e),renderPersonItem(),getPlanetData()})}function t(e){var a=1;e.forEach(function(e){if(e.resolved){var t={id:a,name:e.resolved.name,height:e.resolved.height,mass:e.resolved.mass,birth_year:e.resolved.birth_year,gender:e.resolved.gender};e.resolved.homeworld?t.planet=e.resolved.homeworld.replace(/[^0-9]/g,""):t.planet="Unknown",e.resolved.species[0]?t.species=e.resolved.species[0].replace(/[^0-9]/g,""):t.species="Unknown",peopleDataLocal.push(t)}a++})}var n=document.querySelector(".people-list__item"),o="https://swapi.co/api/people/",r=[];document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){loadGif.classList.add("load-screen__img--movein")},200),setTimeout(function(){loadBalloonImg.classList.add("load-screen__balloon--show")},2200)}),requestSWInfo(o,"GET").then(function(t){var n=t.count;e(n),a(n)},errorHandler)}(),search=function(){function e(){term=searchInput.value;var e=0,a=new RegExp(term,"gi");peopleWrapper.forEach(function(t){t.children[0].dataset.name&&(t.children[0].dataset.name.match(a)||t.children[1].dataset.planet.match(a)?(e++,t.classList.add("people-list__item-wrapper--show"),setTimeout(function(){t.classList.remove("people-list__item-wrapper--fade")},200)):(t.classList.add("people-list__item-wrapper--fade"),setTimeout(function(){t.classList.remove("people-list__item-wrapper--show")},200)))}),0===e?searchInput.classList.add("header__input--no-results"):searchInput.classList.remove("header__input--no-results")}document.querySelectorAll(".people-list__planet");searchInput.addEventListener("change",e),searchInput.addEventListener("keyup",e)}(),sortPeople=function(){var e=document.querySelector(".header__select");e.addEventListener("change",function(){!function(e){peopleDataLocal.sort(function(a,t){return a[e]<t[e]?-1:a[e]>t[e]?1:0})}(e.value),renderPersonItem(),renderPlanetItem()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9tYWluLmpzIiwicGxhbmV0LWxpc3QuanMiLCJtb2RhbC5qcyIsInBlb3BsZS1saXN0LmpzIiwic2VhcmNoLmpzIiwic29ydFBlb3BsZS5qcyJdLCJuYW1lcyI6WyJyZW5kZXJQZXJzb25JdGVtIiwicGVvcGxlRGF0YUxvY2FsIiwiZm9yRWFjaCIsInBlcnNvbiIsImluZGV4IiwicGVvcGxlTmFtZSIsImRhdGFzZXQiLCJuYW1lIiwiaW5uZXJIVE1MIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInNlYXJjaElucHV0IiwidmFsdWUiLCJyZW5kZXJQbGFuZXRJdGVtIiwicGxhbmV0TmFtZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInBlcnNvblBsYW5ldCIsImdldFBlcnNvblBsYW5ldE5hbWUiLCJwbGFuZXQiLCJwbGFuZXRJZCIsIm15UGxhbmV0IiwicGxhbmV0RGF0YUxvY2FsIiwiaWQiLCJwYXJzZUludCIsInJlcXVlc3RTV0luZm8iLCJ1cmwiLCJtZXRob2RUeXBlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3AiLCJyZXNwb25zZVRleHQiLCJyZXNwSnNvbiIsIkpTT04iLCJwYXJzZSIsImNvbnNvbGUiLCJsb2ciLCJlcnJvckhhbmRsZXIiLCJzdGF0dXNDb2RlIiwicmVmbGVjdCIsInByb21pc2UiLCJ0aGVuIiwicmVzb2x2ZWQiLCJyZWplY3RlZCIsImdldFBsYW5ldERhdGEiLCJfcG9wdWxhdGVMaXN0IiwicGxhbmV0TnVtYmVyIiwiaSIsImN1cnJlbnRQbGFuZXRVUkwiLCJwbGFuZXRVUkwiLCJwcm9taXNlcyIsInB1c2giLCJhbGwiLCJtYXAiLCJwbGFuZXRzRGF0YSIsIl9zdG9yZVBsYW5ldERhdGEiLCJfc2V0UGxhbmV0TmFtZVRvUGVvcGxlIiwiX3N0YXJ0QW5pbWF0aW9uIiwicGxhbmV0RGF0YSIsIm5ld1BsYW5ldCIsInRlcnJhaW4iLCJwb3B1bGF0aW9uIiwiZGlhbWV0ZXIiLCJyZXNpZGVudHMiLCJsZW5ndGgiLCJyZXNpZGVudFVSTCIsInJlcGxhY2UiLCJsb2FkU2NyZWVuIiwibG9hZEdpZiIsImxvYWRCYWxsb29uSW1nIiwic2V0VGltZW91dCIsIm1haW4iLCJpdGVtV3JhcHBlciIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGF0YSIsImNvdW50IiwicGVvcGxlR3JpZCIsInBlb3BsZVdyYXBwZXIiLCJtb2RhbCIsIl9nZXRNb2RhbEhUTUwiLCJpbWdDbGFzcyIsInRpdGxlIiwic3VidGl0bGUiLCJkYXRhTGlzdCIsIl9nZXREYXRhTGlzdEhUTUwiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsImVsIiwia2V5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0IiwiY29udGFpbnMiLCJnZW5kZXIiLCJiaXJ0aF95ZWFyIiwiaGVpZ2h0IiwibWFzcyIsInN0b3BQcm9wYWdhdGlvbiIsIndpbmRvdyIsIm9uY2xpY2siLCJldmVudCIsInJlbmRlckxpc3QiLCJfYnVpbGRMaXN0IiwicGVvcGxlTnVtYmVyIiwicGVvcGxlTGlDbG9uZSIsInBlb3BsZUxpIiwiY2xvbmVOb2RlIiwiYXBwZW5kQ2hpbGQiLCJjdXJyZW50UGVyc29uVVJMIiwicGVvcGxlVVJMIiwicGVvcGxlRGF0YSIsIl9zdG9yZVBlb3BsZURhdGEiLCJwZXJzb25EYXRhIiwibmV3UGVyc29uIiwiaG9tZXdvcmxkIiwic3BlY2llcyIsInNlYXJjaCIsIl9maWx0ZXJNYXRjaGVzIiwidGVybSIsIm1hdGNoRmxhZyIsInJlZ2V4IiwiUmVnRXhwIiwicGVyc29uV3JhcHBlciIsImNoaWxkcmVuIiwibWF0Y2giLCJzb3J0UGVvcGxlIiwic2VjdFR5cGUiLCJwcm9wZXJ0eSIsInNvcnQi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Q0EvRCxFQUFBK0QsSUFMQXZFLGNBZkEsR0NBQW9GLE9BQUEsV0FNQSxTQUFBQyxJQUNBQyxLQUFBeEgsWUFBQUMsTUFDQSxJQUFBd0gsRUFBQSxFQUNBQyxFQUFBLElBQUFDLE9BQUFILEtBQUEsTUFDQTdDLGNBQUF0RixRQUFBLFNBQUF1SSxHQUNBQSxFQUFBQyxTQUFBLEdBQUFwSSxRQUFBQyxPQUNBa0ksRUFBQUMsU0FBQSxHQUFBcEksUUFBQUMsS0FBQW9JLE1BQUFKLElBQUFFLEVBQUFDLFNBQUEsR0FBQXBJLFFBQUFlLE9BQUFzSCxNQUFBSixJQUNBRCxJQUNBRyxFQUFBL0gsVUFBQUMsSUFBQSxtQ0FDQXFFLFdBQUEsV0FDQXlELEVBQUEvSCxVQUFBRSxPQUFBLG9DQUNBLE9BRUE2SCxFQUFBL0gsVUFBQUMsSUFBQSxtQ0FDQXFFLFdBQUEsV0FDQXlELEVBQUEvSCxVQUFBRSxPQUFBLG9DQUNBLFNBSUEsSUFBQTBILEVBQUF6SCxZQUFBSCxVQUFBQyxJQUFBLDZCQUFBRSxZQUFBSCxVQUFBRSxPQUFBLDZCQXpCQUssU0FBQUMsaUJBQUEsd0JBRUFMLFlBQUEwRixpQkFBQSxTQUFBNkIsR0FDQXZILFlBQUEwRixpQkFBQSxRQUFBNkIsR0FKQSxHQ0FBUSxXQUFBLFdBQ0EsSUFBQUMsRUFBQTVILFNBQUFtRSxjQUFBLG1CQUVBeUQsRUFBQXRDLGlCQUFBLFNBRUEsWUFLQSxTQUFBdUMsR0FDQTdJLGdCQUFBOEksS0FBQSxTQUFBQyxFQUFBQyxHQUNBLE9BQUFELEVBQUFGLEdBQUFHLEVBQUFILElBQUEsRUFDQUUsRUFBQUYsR0FBQUcsRUFBQUgsR0FBQSxFQUNBLElBUkFJLENBQUFMLEVBQUEvSCxPQUNBZCxtQkFDQWUscUJBUkEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGxvYWRCYWxsb29uSW1nICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkLXNjcmVlbl9fYmFsbG9vbicpO1xudmFyIGxvYWRHaWYgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkLXNjcmVlbl9faW1nJyk7XG52YXIgc2VhcmNoSW5wdXQgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9faW5wdXQnKTtcbnZhciBwZW9wbGVHcmlkICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGVvcGxlLWxpc3RfX2dyaWQnKTtcbnZhciBwZW9wbGVEYXRhTG9jYWwgPSBbXTtcbnZhciBwbGFuZXREYXRhTG9jYWwgPSBbXTtcbnZhciBwZW9wbGVOYW1lOyAvLyBob2xkIHBlb3BsZSBsaXN0IG5hbWUgRE9NIGVsXG52YXIgcGVvcGxlV3JhcHBlcjsgLy8gaG9sZCBwZW9wbGUgbGlzdCB3cmFwcGVyIERPTSBlbFxuXG5mdW5jdGlvbiByZW5kZXJQZXJzb25JdGVtKCkge1xuICBwZW9wbGVEYXRhTG9jYWwuZm9yRWFjaCggZnVuY3Rpb24ocGVyc29uLCBpbmRleCkge1xuICAgIHBlb3BsZU5hbWVbaW5kZXhdLmRhdGFzZXQubmFtZSA9IHBlcnNvbi5uYW1lO1xuICAgIHBlb3BsZU5hbWVbaW5kZXhdLmlubmVySFRNTCA9IHBlcnNvbi5uYW1lO1xuICAgIHBlb3BsZU5hbWVbaW5kZXhdLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tc2hvdycpO1xuICAgIHBlb3BsZU5hbWVbaW5kZXhdLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tZmFkZScpO1xuICAgIHNlYXJjaElucHV0LnZhbHVlID0gXCJcIjtcbiAgICBzZWFyY2hJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoZWFkZXJfX2lucHV0LS1uby1yZXN1bHRzJyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZW5kZXJQbGFuZXRJdGVtKCkge1xuICB2YXIgcGxhbmV0TmFtZSAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVvcGxlLWxpc3RfX3BsYW5ldCcpO1xuXG4gIHBlb3BsZURhdGFMb2NhbC5mb3JFYWNoKCBmdW5jdGlvbihwZXJzb24sIGluZGV4KSB7XG4gICAgdmFyIHBlcnNvblBsYW5ldCA9IGdldFBlcnNvblBsYW5ldE5hbWUocGVyc29uLnBsYW5ldCk7XG4gICAgcGxhbmV0TmFtZVtpbmRleF0uaW5uZXJIVE1MID0gcGVyc29uUGxhbmV0O1xuICAgIHBsYW5ldE5hbWVbaW5kZXhdLmRhdGFzZXQucGxhbmV0ID0gcGVyc29uUGxhbmV0O1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0UGVyc29uUGxhbmV0TmFtZShwbGFuZXRJZCkge1xuICB2YXIgbXlQbGFuZXQgPSAnJztcbiAgcGxhbmV0RGF0YUxvY2FsLmZvckVhY2goZnVuY3Rpb24ocGxhbmV0KSB7XG4gICAgaWYgKHBsYW5ldC5pZCA9PT0gcGFyc2VJbnQocGxhbmV0SWQpKSB7XG4gICAgICBteVBsYW5ldCA9IHBsYW5ldC5uYW1lO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBteVBsYW5ldDtcbn1cblxuZnVuY3Rpb24gcmVxdWVzdFNXSW5mbyh1cmwsIG1ldGhvZFR5cGUpe1xuICB2YXIgcHJvbWlzZU9iaiA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XG4gICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIHhoci5vcGVuKG1ldGhvZFR5cGUsIHVybCwgdHJ1ZSk7XG4gICAgeGhyLnNlbmQoKTtcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKXtcbiAgICAgIGlmKHhoci5yZWFkeVN0YXRlID09PSA0KXtcbiAgICAgICAgIGlmKHhoci5zdGF0dXMgPT09IDIwMCl7XG4gICAgICAgICAgdmFyIHJlc3AgPSB4aHIucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgdmFyIHJlc3BKc29uID0gSlNPTi5wYXJzZShyZXNwKTtcbiAgICAgICAgICAgIHJlc29sdmUocmVzcEpzb24pO1xuICAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgcmVqZWN0KHhoci5zdGF0dXMpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJ4aHIgZmFpbGVkXCIpOyAvLyBUT0RPOiBhcHBlbmQgJ2NhbnQgZmluZCcgbXNnXG4gICAgICAgICAgIH1cbiAgICAgIH0gZWxzZXtcbiAgICAgICAgIGNvbnNvbGUubG9nKFwieGhyIHByb2Nlc3NpbmcgZ29pbmcgb25cIik7IC8vIFRPRE86IGFkZCBsb2FkaW5nIGFuaW1hdGlvblxuICAgICAgICAgfVxuICAgIH07XG4gIH0pO1xuICByZXR1cm4gcHJvbWlzZU9iajtcbn1cblxuZnVuY3Rpb24gZXJyb3JIYW5kbGVyKHN0YXR1c0NvZGUpe1xuICBjb25zb2xlLmxvZyhcImZhaWxlZCB3aXRoIHN0YXR1c1wiLCBzdGF0dXMpO1xufVxuXG5mdW5jdGlvbiByZWZsZWN0KHByb21pc2Upe1xuICByZXR1cm4gcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHJlc29sdmVkKXsgcmV0dXJuIHtyZXNvbHZlZDpyZXNvbHZlZCwgc3RhdHVzOiBcInJlc29sdmVkXCIgfTt9LFxuICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlamVjdGVkKXsgcmV0dXJuIHtyZWplY3RlZDpyZWplY3RlZCwgc3RhdHVzOiBcInJlamVjdGVkXCIgfTt9KTtcbn1cbiIsImZ1bmN0aW9uIGdldFBsYW5ldERhdGEoKXtcbiAgdmFyIGl0ZW1XcmFwcGVyICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlb3BsZS1saXN0X19pdGVtLXdyYXBwZXInKTtcbiAgdmFyIG1haW4gICAgICAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4nKTtcbiAgdmFyIGxvYWRTY3JlZW4gICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxvYWQtc2NyZWVuJyk7XG4gIHZhciBwbGFuZXRVUkwgICAgICA9ICdodHRwczovL3N3YXBpLmNvL2FwaS9wbGFuZXRzLyc7XG4gIHZhciBwcm9taXNlcyAgICAgICA9IFtdO1xuXG4gIHJlcXVlc3RTV0luZm8ocGxhbmV0VVJMLCBcIkdFVFwiKS50aGVuKF9zdGFydExpc3QsIGVycm9ySGFuZGxlcik7XG5cbiAgZnVuY3Rpb24gX3N0YXJ0TGlzdChkYXRhKSB7XG4gICAgdmFyIHBsYW5ldE51bWJlciA9IGRhdGEuY291bnQ7XG4gICAgX3BvcHVsYXRlTGlzdChwbGFuZXROdW1iZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3BvcHVsYXRlTGlzdChwbGFuZXROdW1iZXIpIHtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBwbGFuZXROdW1iZXI7IGkrKykge1xuICAgICAgY3VycmVudFBsYW5ldFVSTCA9IHBsYW5ldFVSTCArIGk7XG4gICAgICBwcm9taXNlcy5wdXNoKHJlcXVlc3RTV0luZm8oY3VycmVudFBsYW5ldFVSTCwgXCJHRVRcIikpO1xuICAgIH1cbiAgICBQcm9taXNlLmFsbChwcm9taXNlcy5tYXAocmVmbGVjdCkpLnRoZW4oZnVuY3Rpb24ocGxhbmV0c0RhdGEpe1xuICAgICAgX3N0b3JlUGxhbmV0RGF0YShwbGFuZXRzRGF0YSk7XG4gICAgICBfc2V0UGxhbmV0TmFtZVRvUGVvcGxlKCk7XG4gICAgICByZW5kZXJQbGFuZXRJdGVtKCk7XG4gICAgICBfc3RhcnRBbmltYXRpb24oKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zdG9yZVBsYW5ldERhdGEocGxhbmV0c0RhdGEpIHtcbiAgICB2YXIgaWQgPSAxO1xuICAgIHBsYW5ldHNEYXRhLmZvckVhY2goZnVuY3Rpb24ocGxhbmV0RGF0YSkge1xuICAgICAgaWYgKHBsYW5ldERhdGEucmVzb2x2ZWQpIHtcbiAgICAgICAgdmFyIG5ld1BsYW5ldCA9IHtcbiAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgbmFtZTogcGxhbmV0RGF0YS5yZXNvbHZlZC5uYW1lLFxuICAgICAgICAgIHRlcnJhaW46IHBsYW5ldERhdGEucmVzb2x2ZWQudGVycmFpbixcbiAgICAgICAgICBwb3B1bGF0aW9uOiBwbGFuZXREYXRhLnJlc29sdmVkLnBvcHVsYXRpb24sXG4gICAgICAgICAgZGlhbWV0ZXI6IHBsYW5ldERhdGEucmVzb2x2ZWQuZGlhbWV0ZXJcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAocGxhbmV0RGF0YS5yZXNvbHZlZC5yZXNpZGVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgbmV3UGxhbmV0LnJlc2lkZW50cyA9IHBsYW5ldERhdGEucmVzb2x2ZWQucmVzaWRlbnRzLm1hcChmdW5jdGlvbihyZXNpZGVudFVSTCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc2lkZW50VVJMLnJlcGxhY2UoL1teMC05XS9nLCcnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXdQbGFuZXQucmVzaWRlbnRzID0gXCJ1bmtub3duXCI7XG4gICAgICAgIH1cbiAgICAgICAgcGxhbmV0RGF0YUxvY2FsLnB1c2gobmV3UGxhbmV0KTtcbiAgICAgIH1cbiAgICAgIGlkKys7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfc2V0UGxhbmV0TmFtZVRvUGVvcGxlKCkge1xuICAgIHBlb3BsZURhdGFMb2NhbC5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbikge1xuICAgICAgcGVyc29uLnBsYW5ldE5hbWUgPSBnZXRQZXJzb25QbGFuZXROYW1lKHBlcnNvbi5wbGFuZXQpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3N0YXJ0QW5pbWF0aW9uKCkge1xuICAgIGxvYWRTY3JlZW4uY2xhc3NMaXN0LmFkZCgnbG9hZC1zY3JlZW4tLWZhZGVvdXQnKTtcbiAgICBsb2FkR2lmLmNsYXNzTGlzdC5hZGQoJ2xvYWQtc2NyZWVuX19pbWctLW1vdmVvdXQnKTtcbiAgICBsb2FkQmFsbG9vbkltZy5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkLXNjcmVlbl9fYmFsbG9vbi0tc2hvdycpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBtYWluLmNsYXNzTGlzdC5hZGQoJ21haW4tLXNob3cnKTtcbiAgICB9LCAxMDAwKTtcbiAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBpdGVtV3JhcHBlci5mb3JFYWNoKCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tc2hvdy1pdGVtcycpO1xuICAgICAgfSk7XG4gICAgfSwgMTIwMCk7XG4gIH1cbn1cbiIsInZhciBtb2RhbCA9IChmdW5jdGlvbigpIHtcbiAgdmFyIG1vZGFsICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XG5cbiAgcGVvcGxlR3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF9idWlsZE1vZGFsLCBmYWxzZSk7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2Nsb3NlTW9kYWwsIGZhbHNlKTtcbiAgd2luZG93Lm9uY2xpY2sgPSBmdW5jdGlvbihldmVudCkge1xuICAgIGlmIChldmVudC50YXJnZXQgPT0gbW9kYWwpIHtcbiAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsLXNob3cnKTtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gX2J1aWxkTW9kYWwoZSkge1xuICAgIGlmKGUudGFyZ2V0ICE9PSBlLmN1cnJlbnRUYXJnZXQgJiYgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwZW9wbGUtbGlzdF9fdmFsdWUnKSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmRhdGFzZXQubmFtZSkge1xuICAgICAgICBwZW9wbGVEYXRhTG9jYWwuZm9yRWFjaChmdW5jdGlvbihwZXJzb24pIHtcbiAgICAgICAgICBpZiAocGVyc29uLm5hbWUgPT09IGUudGFyZ2V0LmRhdGFzZXQubmFtZSkge1xuICAgICAgICAgICAgdmFyIGltZ0NsYXNzID0gJ21vZGFsX19zaWRlLWltZy0tcGVvcGxlJztcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IHBlcnNvbi5uYW1lO1xuICAgICAgICAgICAgdmFyIHN1YnRpdGxlID0gJ1BsYW5ldDwvc3Bhbj48c3BhbiBjbGFzcz1cIm1vZGFsX19jYXJkLXN1YnRpdGxlIG1vZGFsX19jYXJkLXBsYW5ldFwiPicgKyBwZXJzb24ucGxhbmV0TmFtZTtcbiAgICAgICAgICAgIHZhciBkYXRhTGlzdCA9IF9nZXREYXRhTGlzdEhUTUwoe2tleTonSUQ6JywgdmFsdWU6cGVyc29uLmlkfSwge2tleTonR2VuZGVyOicsIHZhbHVlOnBlcnNvbi5nZW5kZXJ9LHtrZXk6J0JpcnRoIFllYXI6JywgdmFsdWU6cGVyc29uLmJpcnRoX3llYXJ9LHtrZXk6J0hlaWdodDonLCB2YWx1ZTpwZXJzb24uaGVpZ2h0ICsgJyBjbSd9LCB7a2V5OidNYXNzOicsIHZhbHVlOiBwZXJzb24ubWFzcyArICcgS2cnfSk7XG5cbiAgICAgICAgICAgIG1vZGFsLmlubmVySFRNTCA9IF9nZXRNb2RhbEhUTUwoaW1nQ2xhc3MsIHRpdGxlLCBzdWJ0aXRsZSwgZGF0YUxpc3QpO1xuICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWwtc2hvdycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwbGFuZXREYXRhTG9jYWwuZm9yRWFjaChmdW5jdGlvbihwbGFuZXQpIHtcbiAgICAgICAgICBpZiAocGxhbmV0Lm5hbWUgPT09IGUudGFyZ2V0LmRhdGFzZXQucGxhbmV0KSB7XG4gICAgICAgICAgICB2YXIgaW1nQ2xhc3MgPSAnbW9kYWxfX3NpZGUtaW1nLS1wbGFuZXQnO1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gcGxhbmV0Lm5hbWU7XG4gICAgICAgICAgICB2YXIgc3VidGl0bGUgPSAnJztcbiAgICAgICAgICAgIHZhciBkYXRhTGlzdCA9IF9nZXREYXRhTGlzdEhUTUwoe2tleTonSUQ6JywgdmFsdWU6cGxhbmV0LmlkfSwge2tleTonVGVycmFpbjonLCB2YWx1ZTpwbGFuZXQudGVycmFpbn0se2tleTonUG9wdWxhdGlvbjonLCB2YWx1ZTpwbGFuZXQucG9wdWxhdGlvbn0se2tleTonRGlhbWV0ZXI6JywgdmFsdWU6cGxhbmV0LmRpYW1ldGVyICsgJyBLbSd9LCB7a2V5OidSZXNpZGVudHM6JywgdmFsdWU6IHBsYW5ldC5yZXNpZGVudHN9KTtcblxuICAgICAgICAgICAgbW9kYWwuaW5uZXJIVE1MID0gX2dldE1vZGFsSFRNTChpbWdDbGFzcywgdGl0bGUsIHN1YnRpdGxlLCBkYXRhTGlzdCk7XG4gICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbC1zaG93Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRNb2RhbEhUTUwoaW1nQ2xhc3MsIHRpdGxlLCBzdWJ0aXRsZSwgZGF0YUxpc3QpIHtcbiAgICB2YXIgbW9kYWxIVE1MID0gJzxkaXYgY2xhc3M9XCJtb2RhbF9fY2FyZFwiPjxkaXYgY2xhc3M9XCJtb2RhbF9fY2xvc2UtYnRuXCI+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19zaWRlLWltZyAnICsgaW1nQ2xhc3MgKyAnXCI+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19jYXJkLWluZm9cIj48ZGl2IGNsYXNzPVwibW9kYWxfX2NhcmQtc3ViamVjdFwiPjxwIGNsYXNzPVwibW9kYWxfX2NhcmQtdGl0bGVcIj4nICsgdGl0bGUgKyAnPC9wPjxzcGFuIGNsYXNzPVwibW9kYWxfX2NhcmQtc3VidGl0bGVcIj4nICsgc3VidGl0bGUgKyAnPC9zcGFuPjwvZGl2Pjx1bCBjbGFzcz1cIm1vZGFsX19pbmZvLWdyaWRcIj4nICsgZGF0YUxpc3QgKyAnPC91bD48L2Rpdj48L2Rpdj4nO1xuICAgIHJldHVybiBtb2RhbEhUTUw7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RGF0YUxpc3RIVE1MKCl7XG4gICAgdmFyIGRhdGFMaXN0ID0gJyc7XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuICAgICAgZGF0YUxpc3QgKz0gICc8bGkgY2xhc3M9XCJtb2RhbF9faW5mby1pdGVtXCI+PHNwYW4gY2xhc3M9XCJtb2RhbF9faW5mby1pdGVtLWtleVwiPicgKyBlbC5rZXkgKyAnPC9zcGFuPjxzcGFuIGNsYXNzPVwibW9kYWxfX2luZm8taXRlbS12YWx1ZVwiPicgKyBlbC52YWx1ZSArICc8L3NwYW4+PC9saT4nO1xuICAgIH0pO1xuICAgIHJldHVybiBkYXRhTGlzdDtcbiAgfVxuXG4gIC8vIGV2ZW50IGRlbGVnYXRpb24gdG8gdGhlIG5ldyBkaXYgaW5zaWRlIG1vZGFsXG4gIGZ1bmN0aW9uIF9jbG9zZU1vZGFsKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ0blwiKSkge1xuICAgICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWwtc2hvdycpO1xuICAgIH1cbiAgfVxufSkoKTtcbiIsInZhciByZW5kZXJMaXN0ID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgcGVvcGxlTGkgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wZW9wbGUtbGlzdF9faXRlbScpO1xuXG4gIHZhciBwZW9wbGVVUkwgPSAnaHR0cHM6Ly9zd2FwaS5jby9hcGkvcGVvcGxlLyc7XG4gIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBsb2FkR2lmLmNsYXNzTGlzdC5hZGQoJ2xvYWQtc2NyZWVuX19pbWctLW1vdmVpbicpO1xuICAgIH0sIDIwMCk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGxvYWRCYWxsb29uSW1nLmNsYXNzTGlzdC5hZGQoJ2xvYWQtc2NyZWVuX19iYWxsb29uLS1zaG93Jyk7XG4gICAgfSwgMjIwMCk7XG4gIH0pO1xuXG4gIHJlcXVlc3RTV0luZm8ocGVvcGxlVVJMLCBcIkdFVFwiKS50aGVuKF9zdGFydExpc3QsIGVycm9ySGFuZGxlcik7XG5cbiAgZnVuY3Rpb24gX3N0YXJ0TGlzdChkYXRhKSB7XG4gICAgdmFyIHBlb3BsZU51bWJlciA9IGRhdGEuY291bnQ7XG4gICAgX2J1aWxkTGlzdChwZW9wbGVOdW1iZXIpO1xuICAgIF9wb3B1bGF0ZUxpc3QocGVvcGxlTnVtYmVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9idWlsZExpc3QocGVvcGxlTnVtYmVyKSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBwZW9wbGVOdW1iZXI7IGkrPTIpIHtcbiAgICAgIHZhciBwZW9wbGVMaUNsb25lID0gcGVvcGxlTGkuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgcGVvcGxlR3JpZC5hcHBlbmRDaGlsZChwZW9wbGVMaUNsb25lKTtcbiAgICB9XG4gICAgcGVvcGxlTmFtZSAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW9wbGUtbGlzdF9fbmFtZScpO1xuICAgIHBlb3BsZVdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlcicpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3BvcHVsYXRlTGlzdChwZW9wbGVOdW1iZXIpIHtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBwZW9wbGVOdW1iZXI7IGkrKykge1xuICAgICAgY3VycmVudFBlcnNvblVSTCA9IHBlb3BsZVVSTCArIGk7XG4gICAgICBwcm9taXNlcy5wdXNoKHJlcXVlc3RTV0luZm8oY3VycmVudFBlcnNvblVSTCwgXCJHRVRcIikpO1xuICAgIH1cbiAgICBQcm9taXNlLmFsbChwcm9taXNlcy5tYXAocmVmbGVjdCkpLnRoZW4oZnVuY3Rpb24ocGVvcGxlRGF0YSl7XG4gICAgICBfc3RvcmVQZW9wbGVEYXRhKHBlb3BsZURhdGEpO1xuICAgICAgcmVuZGVyUGVyc29uSXRlbSgpO1xuICAgICAgZ2V0UGxhbmV0RGF0YSgpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3N0b3JlUGVvcGxlRGF0YShwZW9wbGVEYXRhKSB7XG4gICAgdmFyIGlkID0gMTtcbiAgICBwZW9wbGVEYXRhLmZvckVhY2goZnVuY3Rpb24ocGVyc29uRGF0YSkge1xuICAgICAgaWYgKHBlcnNvbkRhdGEucmVzb2x2ZWQpIHtcbiAgICAgICAgdmFyIG5ld1BlcnNvbiA9IHtcbiAgICAgICAgICBpZCAgICAgICAgIDogaWQsXG4gICAgICAgICAgbmFtZSAgICAgICA6IHBlcnNvbkRhdGEucmVzb2x2ZWQubmFtZSxcbiAgICAgICAgICBoZWlnaHQgICAgIDogcGVyc29uRGF0YS5yZXNvbHZlZC5oZWlnaHQsXG4gICAgICAgICAgbWFzcyAgICAgICA6IHBlcnNvbkRhdGEucmVzb2x2ZWQubWFzcyxcbiAgICAgICAgICBiaXJ0aF95ZWFyIDogcGVyc29uRGF0YS5yZXNvbHZlZC5iaXJ0aF95ZWFyLFxuICAgICAgICAgIGdlbmRlciAgICAgOiBwZXJzb25EYXRhLnJlc29sdmVkLmdlbmRlclxuICAgICAgICB9O1xuICAgICAgICBwZXJzb25EYXRhLnJlc29sdmVkLmhvbWV3b3JsZCA/XG4gICAgICAgIG5ld1BlcnNvbi5wbGFuZXQgPSBwZXJzb25EYXRhLnJlc29sdmVkLmhvbWV3b3JsZC5yZXBsYWNlKC9bXjAtOV0vZywnJykgOlxuICAgICAgICBuZXdQZXJzb24ucGxhbmV0ID0gXCJVbmtub3duXCI7XG5cbiAgICAgICAgcGVyc29uRGF0YS5yZXNvbHZlZC5zcGVjaWVzWzBdID9cbiAgICAgICAgbmV3UGVyc29uLnNwZWNpZXMgPSBwZXJzb25EYXRhLnJlc29sdmVkLnNwZWNpZXNbMF0ucmVwbGFjZSgvW14wLTldL2csJycpIDpcbiAgICAgICAgbmV3UGVyc29uLnNwZWNpZXMgPSBcIlVua25vd25cIjtcblxuICAgICAgICBwZW9wbGVEYXRhTG9jYWwucHVzaChuZXdQZXJzb24pO1xuICAgICAgfVxuICAgICAgaWQrKztcbiAgICB9KTtcbiAgfVxufSkoKTtcbiIsInZhciBzZWFyY2ggID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgcGxhbmV0TmFtZSAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVvcGxlLWxpc3RfX3BsYW5ldCcpO1xuXG4gIHNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIF9maWx0ZXJNYXRjaGVzKTtcbiAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBfZmlsdGVyTWF0Y2hlcyk7XG5cbiAgZnVuY3Rpb24gX2ZpbHRlck1hdGNoZXMoKSB7XG4gICAgdGVybSA9IHNlYXJjaElucHV0LnZhbHVlO1xuICAgIHZhciBtYXRjaEZsYWcgPSAwO1xuICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAodGVybSwgJ2dpJyk7XG4gICAgcGVvcGxlV3JhcHBlci5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbldyYXBwZXIpIHtcbiAgICAgIGlmKHBlcnNvbldyYXBwZXIuY2hpbGRyZW5bMF0uZGF0YXNldC5uYW1lKSB7XG4gICAgICAgIGlmIChwZXJzb25XcmFwcGVyLmNoaWxkcmVuWzBdLmRhdGFzZXQubmFtZS5tYXRjaChyZWdleCkgfHwgcGVyc29uV3JhcHBlci5jaGlsZHJlblsxXS5kYXRhc2V0LnBsYW5ldC5tYXRjaChyZWdleCkpIHtcbiAgICAgICAgICBtYXRjaEZsYWcrKztcbiAgICAgICAgICAgIHBlcnNvbldyYXBwZXIuY2xhc3NMaXN0LmFkZCgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tc2hvdycpO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcGVyc29uV3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1mYWRlJyk7XG4gICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcGVyc29uV3JhcHBlci5jbGFzc0xpc3QuYWRkKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1mYWRlJyk7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGVyc29uV3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1zaG93Jyk7XG4gICAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIG1hdGNoRmxhZyA9PT0gMCA/IHNlYXJjaElucHV0LmNsYXNzTGlzdC5hZGQoJ2hlYWRlcl9faW5wdXQtLW5vLXJlc3VsdHMnKSA6IHNlYXJjaElucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hlYWRlcl9faW5wdXQtLW5vLXJlc3VsdHMnKVxuICB9XG59KSgpO1xuIiwidmFyIHNvcnRQZW9wbGUgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBzZWN0VHlwZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXJfX3NlbGVjdCcpO1xuXG4gIHNlY3RUeXBlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIF9zb3J0UGVvcGxlRGF0YUxvY2FsKTtcblxuICBmdW5jdGlvbiBfc29ydFBlb3BsZURhdGFMb2NhbCgpIHtcbiAgICBfc29ydEJ5KHNlY3RUeXBlLnZhbHVlKTtcbiAgICByZW5kZXJQZXJzb25JdGVtKCk7XG4gICAgcmVuZGVyUGxhbmV0SXRlbSgpO1xuXG4gICAgZnVuY3Rpb24gX3NvcnRCeShwcm9wZXJ0eSkge1xuICAgICAgcGVvcGxlRGF0YUxvY2FsLnNvcnQoZnVuY3Rpb24oYSwgYil7XG4gICAgICAgIGlmKGFbcHJvcGVydHldIDwgYltwcm9wZXJ0eV0pIHJldHVybiAtMTtcbiAgICAgICAgaWYoYVtwcm9wZXJ0eV0gPiBiW3Byb3BlcnR5XSkgcmV0dXJuIDE7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KSgpO1xuXG4iXX0=
