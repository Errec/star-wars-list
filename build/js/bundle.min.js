function renderPersonItem(){peopleDataLocal.forEach(function(e,t){peopleName[t].dataset.name=e.name,peopleName[t].innerHTML=e.name,peopleName[t].parentElement.classList.add("people-list__item-wrapper--show"),peopleName[t].parentElement.classList.remove("people-list__item-wrapper--fade"),searchInput.value="",searchInput.classList.remove("header__input--no-results")})}function renderPlanetItem(){var e=document.querySelectorAll(".people-list__planet");peopleDataLocal.forEach(function(t,a){var n=getPersonPlanetName(t.planet);e[a].innerHTML=n,e[a].dataset.planet=n})}function getPersonPlanetName(e){var t="";return planetDataLocal.forEach(function(a){a.id!==parseInt(e)||(t=a.name)}),t}function requestSWInfo(e,t){return new Promise(function(a,n){var o=new XMLHttpRequest;o.open(t,e,!0),o.send(),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var e=o.responseText,t=JSON.parse(e);a(t)}else n(o.status),console.log("xhr failed");else console.log("xhr processing going on")}})}function errorHandler(e){console.log("failed with status",status)}function reflect(e){return e.then(function(e){return{resolved:e,status:"resolved"}},function(e){return{rejected:e,status:"rejected"}})}function getPlanetData(){function e(e){for(var a=1;a<=e;a++)currentPlanetURL=i+a,c.push(requestSWInfo(currentPlanetURL,"GET"));Promise.all(c.map(reflect)).then(function(e){t(e),n(),renderPlanetItem(),o()})}function t(e){var t=1;e.forEach(function(e){if(e.resolved){var n={id:t,name:e.resolved.name,terrain:e.resolved.terrain,population:e.resolved.population,diameter:e.resolved.diameter};e.resolved.residents.length?(n.residents=e.resolved.residents.map(function(e){return e.replace(/[^0-9]/g,"")}),n.residentsNames=n.residents.map(function(e){return a(e)})):(n.residents="unknown",n.residentsNames="unknown"),planetDataLocal.push(n)}t++})}function a(e){var t="";return peopleDataLocal.forEach(function(a){a.id===parseInt(e)&&(t=a.name)}),t}function n(){peopleDataLocal.forEach(function(e){e.planetName=getPersonPlanetName(e.planet)})}function o(){l.classList.add("load-screen--fadeout"),loadGif.classList.add("load-screen__img--moveout"),loadBalloonImg.classList.remove("load-screen__balloon--show"),setTimeout(function(){s.classList.add("main--show")},1e3),setTimeout(function(){r.forEach(function(e){e.classList.add("people-list__item-wrapper--show-items")})},1200)}var r=document.querySelectorAll(".people-list__item-wrapper"),s=document.querySelector(".main"),l=document.querySelector(".load-screen"),i="https://swapi.co/api/planets/",c=[];requestSWInfo(i,"GET").then(function(t){e(t.count)},errorHandler)}var loadBalloonImg=document.querySelector(".load-screen__balloon"),loadGif=document.querySelector(".load-screen__img"),searchInput=document.querySelector(".header__input"),peopleGrid=document.querySelector(".people-list__grid"),peopleDataLocal=[],planetDataLocal=[],peopleName,peopleWrapper,modal=function(){function e(e){peopleDataLocal.forEach(function(t){if(t.name===e.dataset.name){var r=t.name,s='Planet</span><span data-planet="'+t.planetName+'" class="modal__card-subtitle modal__card-planet">'+t.planetName,l=n({key:"ID:",value:t.id},{key:"Gender:",value:t.gender},{key:"Birth Year:",value:t.birth_year},{key:"Height:",value:t.height+" cm"},{key:"Mass:",value:t.mass+" Kg"});o.innerHTML=a("modal__side-img--people",r,s,l),o.classList.add("modal-show")}})}function t(e){planetDataLocal.forEach(function(t){if(t.name===e.dataset.planet){var r=t.name,s=n({key:"ID:",value:t.id},{key:"Terrain:",value:t.terrain},{key:"Population:",value:t.population},{key:"Diameter:",value:t.diameter+" Km"},{key:"Residents:",value:t.residentsNames});o.innerHTML=a("modal__side-img--planet",r,"",s),o.classList.add("modal-show")}})}function a(e,t,a,n){return'<div class="modal__card"><div class="modal__close-btn"></div><div class="modal__side-img '+e+'"></div><div class="modal__card-info"><div class="modal__card-subject"><p class="modal__card-title">'+t+'</p><span class="modal__card-subtitle">'+a+'</span></div><ul class="modal__info-grid">'+n+"</ul></div></div>"}function n(){var e="";return Array.prototype.slice.call(arguments).forEach(function(t){e+='<li class="modal__info-item"><span class="modal__info-item-key">'+t.key+'</span><span class="modal__info-item-value">'+t.value+"</span></li>"}),e}var o=document.querySelector(".modal");peopleGrid.addEventListener("click",function(a){a.target!==a.currentTarget&&a.target.classList.contains("people-list__value")&&(a.target.dataset.name?e(a.target):t(a.target)),a.stopPropagation()},!1),o.addEventListener("click",function(e){e.target&&e.target.classList.contains("modal__close-btn")&&o.classList.remove("modal-show")},!1),o.addEventListener("click",function(e){e.target&&e.target.classList.contains("modal__card-planet")&&t(e.target)},!1),window.addEventListener("click",function(e){e.target==o&&o.classList.remove("modal-show")})}(),renderList=function(){function e(e){for(var t=1;t<e;t+=2){var a=n.cloneNode(!0);peopleGrid.appendChild(a)}peopleName=document.querySelectorAll(".people-list__name"),peopleWrapper=document.querySelectorAll(".people-list__item-wrapper")}function t(e){for(var t=1;t<=e;t++)currentPersonURL=o+t,r.push(requestSWInfo(currentPersonURL,"GET"));Promise.all(r.map(reflect)).then(function(e){a(e),renderPersonItem(),getPlanetData()})}function a(e){var t=1;e.forEach(function(e){if(e.resolved){var a={id:t,name:e.resolved.name,height:e.resolved.height,mass:e.resolved.mass,birth_year:e.resolved.birth_year,gender:e.resolved.gender};e.resolved.homeworld?a.planet=e.resolved.homeworld.replace(/[^0-9]/g,""):a.planet="Unknown",e.resolved.species[0]?a.species=e.resolved.species[0].replace(/[^0-9]/g,""):a.species="Unknown",peopleDataLocal.push(a)}t++})}var n=document.querySelector(".people-list__item"),o="https://swapi.co/api/people/",r=[];document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){loadGif.classList.add("load-screen__img--movein")},200),setTimeout(function(){loadBalloonImg.classList.add("load-screen__balloon--show")},2200)}),requestSWInfo(o,"GET").then(function(a){var n=a.count;e(n),t(n)},errorHandler)}(),search=function(){function e(){term=searchInput.value;var e=0,t=new RegExp(term,"gi");peopleWrapper.forEach(function(a){a.children[0].dataset.name&&(a.children[0].dataset.name.match(t)||a.children[1].dataset.planet.match(t)?(e++,a.classList.add("people-list__item-wrapper--show"),setTimeout(function(){a.classList.remove("people-list__item-wrapper--fade")},200)):(a.classList.add("people-list__item-wrapper--fade"),setTimeout(function(){a.classList.remove("people-list__item-wrapper--show")},200)))}),0===e?searchInput.classList.add("header__input--no-results"):searchInput.classList.remove("header__input--no-results")}document.querySelectorAll(".people-list__planet");searchInput.addEventListener("change",e),searchInput.addEventListener("keyup",e)}(),sortPeople=function(){var e=document.querySelector(".header__select");e.addEventListener("change",function(){!function(e){peopleDataLocal.sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0})}(e.value),renderPersonItem(),renderPlanetItem()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9tYWluLmpzIiwicGxhbmV0LWxpc3QuanMiLCJtb2RhbC5qcyIsInBlb3BsZS1saXN0LmpzIiwic2VhcmNoLmpzIiwic29ydFBlb3BsZS5qcyJdLCJuYW1lcyI6WyJyZW5kZXJQZXJzb25JdGVtIiwicGVvcGxlRGF0YUxvY2FsIiwiZm9yRWFjaCIsInBlcnNvbiIsImluZGV4IiwicGVvcGxlTmFtZSIsImRhdGFzZXQiLCJuYW1lIiwiaW5uZXJIVE1MIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInNlYXJjaElucHV0IiwidmFsdWUiLCJyZW5kZXJQbGFuZXRJdGVtIiwicGxhbmV0TmFtZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInBlcnNvblBsYW5ldCIsImdldFBlcnNvblBsYW5ldE5hbWUiLCJwbGFuZXQiLCJwbGFuZXRJZCIsIm15UGxhbmV0IiwicGxhbmV0RGF0YUxvY2FsIiwiaWQiLCJwYXJzZUludCIsInJlcXVlc3RTV0luZm8iLCJ1cmwiLCJtZXRob2RUeXBlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3AiLCJyZXNwb25zZVRleHQiLCJyZXNwSnNvbiIsIkpTT04iLCJwYXJzZSIsImNvbnNvbGUiLCJsb2ciLCJlcnJvckhhbmRsZXIiLCJzdGF0dXNDb2RlIiwicmVmbGVjdCIsInByb21pc2UiLCJ0aGVuIiwicmVzb2x2ZWQiLCJyZWplY3RlZCIsImdldFBsYW5ldERhdGEiLCJfcG9wdWxhdGVMaXN0IiwicGxhbmV0TnVtYmVyIiwiaSIsImN1cnJlbnRQbGFuZXRVUkwiLCJwbGFuZXRVUkwiLCJwcm9taXNlcyIsInB1c2giLCJhbGwiLCJtYXAiLCJwbGFuZXRzRGF0YSIsIl9zdG9yZVBsYW5ldERhdGEiLCJfc2V0UGxhbmV0TmFtZVRvUGVvcGxlIiwiX3N0YXJ0QW5pbWF0aW9uIiwicGxhbmV0RGF0YSIsIm5ld1BsYW5ldCIsInRlcnJhaW4iLCJwb3B1bGF0aW9uIiwiZGlhbWV0ZXIiLCJyZXNpZGVudHMiLCJsZW5ndGgiLCJyZXNpZGVudFVSTCIsInJlcGxhY2UiLCJyZXNpZGVudHNOYW1lcyIsInJlc2lkZW50SUQiLCJfZ2V0UmVzaWRlbnROYW1lIiwicGVyc29uTmFtZSIsImxvYWRTY3JlZW4iLCJsb2FkR2lmIiwibG9hZEJhbGxvb25JbWciLCJzZXRUaW1lb3V0IiwibWFpbiIsIml0ZW1XcmFwcGVyIiwiZWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJkYXRhIiwiY291bnQiLCJwZW9wbGVHcmlkIiwicGVvcGxlV3JhcHBlciIsIm1vZGFsIiwiX3JlbmRlclBlcnNvbkRhdGEiLCJ0YXJnZXQiLCJ0aXRsZSIsInN1YnRpdGxlIiwiZGF0YUxpc3QiLCJfZ2V0RGF0YUxpc3RIVE1MIiwia2V5IiwiZ2VuZGVyIiwiYmlydGhfeWVhciIsImhlaWdodCIsIm1hc3MiLCJfZ2V0TW9kYWxIVE1MIiwiX3JlbmRlclBsYW5ldERhdGEiLCJpbWdDbGFzcyIsIkFycmF5IiwicHJvdG90eXBlIiwic2xpY2UiLCJjYWxsIiwiYXJndW1lbnRzIiwiZWwiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImN1cnJlbnRUYXJnZXQiLCJjb250YWlucyIsInN0b3BQcm9wYWdhdGlvbiIsIndpbmRvdyIsImV2ZW50IiwicmVuZGVyTGlzdCIsIl9idWlsZExpc3QiLCJwZW9wbGVOdW1iZXIiLCJwZW9wbGVMaUNsb25lIiwicGVvcGxlTGkiLCJjbG9uZU5vZGUiLCJhcHBlbmRDaGlsZCIsImN1cnJlbnRQZXJzb25VUkwiLCJwZW9wbGVVUkwiLCJwZW9wbGVEYXRhIiwiX3N0b3JlUGVvcGxlRGF0YSIsInBlcnNvbkRhdGEiLCJuZXdQZXJzb24iLCJob21ld29ybGQiLCJzcGVjaWVzIiwic2VhcmNoIiwiX2ZpbHRlck1hdGNoZXMiLCJ0ZXJtIiwibWF0Y2hGbGFnIiwicmVnZXgiLCJSZWdFeHAiLCJwZXJzb25XcmFwcGVyIiwiY2hpbGRyZW4iLCJtYXRjaCIsInNvcnRQZW9wbGUiLCJzZWN0VHlwZSIsInByb3BlcnR5Iiwic29ydCIsImEiLCJiIiwiX3NvcnRCeSJdLCJtYXBwaW5ncyI6IkFBU0EsU0FBQUEsbUJBQ0FDLGdCQUFBQyxRQUFBLFNBQUFDLEVBQUFDLEdBQ0FDLFdBQUFELEdBQUFFLFFBQUFDLEtBQUFKLEVBQUFJLEtBQ0FGLFdBQUFELEdBQUFJLFVBQUFMLEVBQUFJLEtBQ0FGLFdBQUFELEdBQUFLLGNBQUFDLFVBQUFDLElBQUEsbUNBQ0FOLFdBQUFELEdBQUFLLGNBQUFDLFVBQUFFLE9BQUEsbUNBQ0FDLFlBQUFDLE1BQUEsR0FDQUQsWUFBQUgsVUFBQUUsT0FBQSwrQkFJQSxTQUFBRyxtQkFDQSxJQUFBQyxFQUFBQyxTQUFBQyxpQkFBQSx3QkFFQWpCLGdCQUFBQyxRQUFBLFNBQUFDLEVBQUFDLEdBQ0EsSUFBQWUsRUFBQUMsb0JBQUFqQixFQUFBa0IsUUFDQUwsRUFBQVosR0FBQUksVUFBQVcsRUFDQUgsRUFBQVosR0FBQUUsUUFBQWUsT0FBQUYsSUFJQSxTQUFBQyxvQkFBQUUsR0FDQSxJQUFBQyxFQUFBLEdBT0EsT0FOQUMsZ0JBQUF0QixRQUFBLFNBQUFtQixHQUNBQSxFQUFBSSxLQUFBQyxTQUFBSixLQUNBQyxFQUFBRixFQUFBZCxRQUlBZ0IsRUFHQSxTQUFBSSxjQUFBQyxFQUFBQyxHQW9CQSxPQW5CQSxJQUFBQyxRQUFBLFNBQUFDLEVBQUFDLEdBQ0EsSUFBQUMsRUFBQSxJQUFBQyxlQUNBRCxFQUFBRSxLQUFBTixFQUFBRCxHQUFBLEdBQ0FLLEVBQUFHLE9BQ0FILEVBQUFJLG1CQUFBLFdBQ0EsR0FBQSxJQUFBSixFQUFBSyxXQUNBLEdBQUEsTUFBQUwsRUFBQU0sT0FBQSxDQUNBLElBQUFDLEVBQUFQLEVBQUFRLGFBQ0FDLEVBQUFDLEtBQUFDLE1BQUFKLEdBQ0FULEVBQUFXLFFBRUFWLEVBQUFDLEVBQUFNLFFBQ0FNLFFBQUFDLElBQUEs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WUFBQUgsVUFBQUMsSUFBQSw2QkFBQUUsWUFBQUgsVUFBQUUsT0FBQSw2QkF6QkFLLFNBQUFDLGlCQUFBLHdCQUVBTCxZQUFBcUcsaUJBQUEsU0FBQXVCLEdBQ0E1SCxZQUFBcUcsaUJBQUEsUUFBQXVCLEdBSkEsR0NBQVEsV0FBQSxXQUNBLElBQUFDLEVBQUFqSSxTQUFBdUUsY0FBQSxtQkFFQTBELEVBQUFoQyxpQkFBQSxTQUVBLFlBS0EsU0FBQWlDLEdBQ0FsSixnQkFBQW1KLEtBQUEsU0FBQUMsRUFBQUMsR0FDQSxPQUFBRCxFQUFBRixHQUFBRyxFQUFBSCxJQUFBLEVBQ0FFLEVBQUFGLEdBQUFHLEVBQUFILEdBQUEsRUFDQSxJQVJBSSxDQUFBTCxFQUFBcEksT0FDQWQsbUJBQ0FlLHFCQVJBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBsb2FkQmFsbG9vbkltZyAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZC1zY3JlZW5fX2JhbGxvb24nKTtcbnZhciBsb2FkR2lmICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZC1zY3JlZW5fX2ltZycpO1xudmFyIHNlYXJjaElucHV0ICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXJfX2lucHV0Jyk7XG52YXIgcGVvcGxlR3JpZCAgICAgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBlb3BsZS1saXN0X19ncmlkJyk7XG52YXIgcGVvcGxlRGF0YUxvY2FsID0gW107XG52YXIgcGxhbmV0RGF0YUxvY2FsID0gW107XG52YXIgcGVvcGxlTmFtZTsgLy8gaG9sZCBwZW9wbGUgbGlzdCBuYW1lIERPTSBlbFxudmFyIHBlb3BsZVdyYXBwZXI7IC8vIGhvbGQgcGVvcGxlIGxpc3Qgd3JhcHBlciBET00gZWxcblxuZnVuY3Rpb24gcmVuZGVyUGVyc29uSXRlbSgpIHtcbiAgcGVvcGxlRGF0YUxvY2FsLmZvckVhY2goIGZ1bmN0aW9uKHBlcnNvbiwgaW5kZXgpIHtcbiAgICBwZW9wbGVOYW1lW2luZGV4XS5kYXRhc2V0Lm5hbWUgPSBwZXJzb24ubmFtZTtcbiAgICBwZW9wbGVOYW1lW2luZGV4XS5pbm5lckhUTUwgPSBwZXJzb24ubmFtZTtcbiAgICBwZW9wbGVOYW1lW2luZGV4XS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Blb3BsZS1saXN0X19pdGVtLXdyYXBwZXItLXNob3cnKTtcbiAgICBwZW9wbGVOYW1lW2luZGV4XS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Blb3BsZS1saXN0X19pdGVtLXdyYXBwZXItLWZhZGUnKTtcbiAgICBzZWFyY2hJbnB1dC52YWx1ZSA9IFwiXCI7XG4gICAgc2VhcmNoSW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnaGVhZGVyX19pbnB1dC0tbm8tcmVzdWx0cycpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyUGxhbmV0SXRlbSgpIHtcbiAgdmFyIHBsYW5ldE5hbWUgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlb3BsZS1saXN0X19wbGFuZXQnKTtcblxuICBwZW9wbGVEYXRhTG9jYWwuZm9yRWFjaCggZnVuY3Rpb24ocGVyc29uLCBpbmRleCkge1xuICAgIHZhciBwZXJzb25QbGFuZXQgPSBnZXRQZXJzb25QbGFuZXROYW1lKHBlcnNvbi5wbGFuZXQpO1xuICAgIHBsYW5ldE5hbWVbaW5kZXhdLmlubmVySFRNTCA9IHBlcnNvblBsYW5ldDtcbiAgICBwbGFuZXROYW1lW2luZGV4XS5kYXRhc2V0LnBsYW5ldCA9IHBlcnNvblBsYW5ldDtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFBlcnNvblBsYW5ldE5hbWUocGxhbmV0SWQpIHtcbiAgdmFyIG15UGxhbmV0ID0gJyc7XG4gIHBsYW5ldERhdGFMb2NhbC5mb3JFYWNoKGZ1bmN0aW9uKHBsYW5ldCkge1xuICAgIGlmIChwbGFuZXQuaWQgPT09IHBhcnNlSW50KHBsYW5ldElkKSkge1xuICAgICAgbXlQbGFuZXQgPSBwbGFuZXQubmFtZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gbXlQbGFuZXQ7XG59XG5cbmZ1bmN0aW9uIHJlcXVlc3RTV0luZm8odXJsLCBtZXRob2RUeXBlKXtcbiAgdmFyIHByb21pc2VPYmogPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3Qpe1xuICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB4aHIub3BlbihtZXRob2RUeXBlLCB1cmwsIHRydWUpO1xuICAgIHhoci5zZW5kKCk7XG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCl7XG4gICAgICBpZih4aHIucmVhZHlTdGF0ZSA9PT0gNCl7XG4gICAgICAgICBpZih4aHIuc3RhdHVzID09PSAyMDApe1xuICAgICAgICAgIHZhciByZXNwID0geGhyLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgIHZhciByZXNwSnNvbiA9IEpTT04ucGFyc2UocmVzcCk7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3BKc29uKTtcbiAgICAgICAgIH0gZWxzZXtcbiAgICAgICAgICAgIHJlamVjdCh4aHIuc3RhdHVzKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwieGhyIGZhaWxlZFwiKTsgLy8gVE9ETzogYXBwZW5kICdjYW50IGZpbmQnIG1zZ1xuICAgICAgICAgICB9XG4gICAgICB9IGVsc2V7XG4gICAgICAgICBjb25zb2xlLmxvZyhcInhociBwcm9jZXNzaW5nIGdvaW5nIG9uXCIpOyAvLyBUT0RPOiBhZGQgbG9hZGluZyBhbmltYXRpb25cbiAgICAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgcmV0dXJuIHByb21pc2VPYmo7XG59XG5cbmZ1bmN0aW9uIGVycm9ySGFuZGxlcihzdGF0dXNDb2RlKXtcbiAgY29uc29sZS5sb2coXCJmYWlsZWQgd2l0aCBzdGF0dXNcIiwgc3RhdHVzKTtcbn1cblxuZnVuY3Rpb24gcmVmbGVjdChwcm9taXNlKXtcbiAgcmV0dXJuIHByb21pc2UudGhlbihmdW5jdGlvbihyZXNvbHZlZCl7IHJldHVybiB7cmVzb2x2ZWQ6cmVzb2x2ZWQsIHN0YXR1czogXCJyZXNvbHZlZFwiIH07fSxcbiAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihyZWplY3RlZCl7IHJldHVybiB7cmVqZWN0ZWQ6cmVqZWN0ZWQsIHN0YXR1czogXCJyZWplY3RlZFwiIH07fSk7XG59XG4iLCJmdW5jdGlvbiBnZXRQbGFuZXREYXRhKCl7XG4gIHZhciBpdGVtV3JhcHBlciAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyJyk7XG4gIHZhciBtYWluICAgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYWluJyk7XG4gIHZhciBsb2FkU2NyZWVuICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2FkLXNjcmVlbicpO1xuICB2YXIgcGxhbmV0VVJMICAgICAgPSAnaHR0cHM6Ly9zd2FwaS5jby9hcGkvcGxhbmV0cy8nO1xuICB2YXIgcHJvbWlzZXMgICAgICAgPSBbXTtcblxuICByZXF1ZXN0U1dJbmZvKHBsYW5ldFVSTCwgXCJHRVRcIikudGhlbihfc3RhcnRMaXN0LCBlcnJvckhhbmRsZXIpO1xuXG4gIGZ1bmN0aW9uIF9zdGFydExpc3QoZGF0YSkge1xuICAgIHZhciBwbGFuZXROdW1iZXIgPSBkYXRhLmNvdW50O1xuICAgIF9wb3B1bGF0ZUxpc3QocGxhbmV0TnVtYmVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9wb3B1bGF0ZUxpc3QocGxhbmV0TnVtYmVyKSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gcGxhbmV0TnVtYmVyOyBpKyspIHtcbiAgICAgIGN1cnJlbnRQbGFuZXRVUkwgPSBwbGFuZXRVUkwgKyBpO1xuICAgICAgcHJvbWlzZXMucHVzaChyZXF1ZXN0U1dJbmZvKGN1cnJlbnRQbGFuZXRVUkwsIFwiR0VUXCIpKTtcbiAgICB9XG4gICAgUHJvbWlzZS5hbGwocHJvbWlzZXMubWFwKHJlZmxlY3QpKS50aGVuKGZ1bmN0aW9uKHBsYW5ldHNEYXRhKXtcbiAgICAgIF9zdG9yZVBsYW5ldERhdGEocGxhbmV0c0RhdGEpO1xuICAgICAgX3NldFBsYW5ldE5hbWVUb1Blb3BsZSgpO1xuICAgICAgcmVuZGVyUGxhbmV0SXRlbSgpO1xuICAgICAgX3N0YXJ0QW5pbWF0aW9uKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RvcmVQbGFuZXREYXRhKHBsYW5ldHNEYXRhKSB7XG4gICAgdmFyIGlkID0gMTtcbiAgICBwbGFuZXRzRGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHBsYW5ldERhdGEpIHtcbiAgICAgIGlmIChwbGFuZXREYXRhLnJlc29sdmVkKSB7XG4gICAgICAgIHZhciBuZXdQbGFuZXQgPSB7XG4gICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgIG5hbWU6IHBsYW5ldERhdGEucmVzb2x2ZWQubmFtZSxcbiAgICAgICAgICB0ZXJyYWluOiBwbGFuZXREYXRhLnJlc29sdmVkLnRlcnJhaW4sXG4gICAgICAgICAgcG9wdWxhdGlvbjogcGxhbmV0RGF0YS5yZXNvbHZlZC5wb3B1bGF0aW9uLFxuICAgICAgICAgIGRpYW1ldGVyOiBwbGFuZXREYXRhLnJlc29sdmVkLmRpYW1ldGVyXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHBsYW5ldERhdGEucmVzb2x2ZWQucmVzaWRlbnRzLmxlbmd0aCkge1xuICAgICAgICAgIG5ld1BsYW5ldC5yZXNpZGVudHMgPSBwbGFuZXREYXRhLnJlc29sdmVkLnJlc2lkZW50cy5tYXAoZnVuY3Rpb24ocmVzaWRlbnRVUkwpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNpZGVudFVSTC5yZXBsYWNlKC9bXjAtOV0vZywnJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgbmV3UGxhbmV0LnJlc2lkZW50c05hbWVzID0gbmV3UGxhbmV0LnJlc2lkZW50cy5tYXAoZnVuY3Rpb24ocmVzaWRlbnRJRCkge1xuICAgICAgICAgICAgcmV0dXJuIF9nZXRSZXNpZGVudE5hbWUocmVzaWRlbnRJRCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3UGxhbmV0LnJlc2lkZW50cyA9IFwidW5rbm93blwiO1xuICAgICAgICAgIG5ld1BsYW5ldC5yZXNpZGVudHNOYW1lcyA9IFwidW5rbm93blwiO1xuICAgICAgICB9XG4gICAgICAgIHBsYW5ldERhdGFMb2NhbC5wdXNoKG5ld1BsYW5ldCk7XG4gICAgICB9XG4gICAgICBpZCsrO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldFJlc2lkZW50TmFtZShyZXNpZGVudElEKSB7XG4gICAgdmFyIHBlcnNvbk5hbWUgPSAnJztcbiAgICBwZW9wbGVEYXRhTG9jYWwuZm9yRWFjaChmdW5jdGlvbihwZXJzb24pIHtcbiAgICAgIGlmIChwZXJzb24uaWQgPT09IHBhcnNlSW50KHJlc2lkZW50SUQpKSB7XG4gICAgICAgIHBlcnNvbk5hbWUgPSBwZXJzb24ubmFtZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcGVyc29uTmFtZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zZXRQbGFuZXROYW1lVG9QZW9wbGUoKSB7XG4gICAgcGVvcGxlRGF0YUxvY2FsLmZvckVhY2goZnVuY3Rpb24ocGVyc29uKSB7XG4gICAgICBwZXJzb24ucGxhbmV0TmFtZSA9IGdldFBlcnNvblBsYW5ldE5hbWUocGVyc29uLnBsYW5ldCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RhcnRBbmltYXRpb24oKSB7XG4gICAgbG9hZFNjcmVlbi5jbGFzc0xpc3QuYWRkKCdsb2FkLXNjcmVlbi0tZmFkZW91dCcpO1xuICAgIGxvYWRHaWYuY2xhc3NMaXN0LmFkZCgnbG9hZC1zY3JlZW5fX2ltZy0tbW92ZW91dCcpO1xuICAgIGxvYWRCYWxsb29uSW1nLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWQtc2NyZWVuX19iYWxsb29uLS1zaG93Jyk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIG1haW4uY2xhc3NMaXN0LmFkZCgnbWFpbi0tc2hvdycpO1xuICAgIH0sIDEwMDApO1xuICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGl0ZW1XcmFwcGVyLmZvckVhY2goIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwZW9wbGUtbGlzdF9faXRlbS13cmFwcGVyLS1zaG93LWl0ZW1zJyk7XG4gICAgICB9KTtcbiAgICB9LCAxMjAwKTtcbiAgfVxufVxuIiwidmFyIG1vZGFsID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgbW9kYWwgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcblxuICBwZW9wbGVHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX2J1aWxkTW9kYWwsIGZhbHNlKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfY2xvc2VNb2RhbCwgZmFsc2UpO1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF9vcGVuUGxhbmV0TW9kYWwsIGZhbHNlKTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtpZiAoZXZlbnQudGFyZ2V0ID09IG1vZGFsKSB7IG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsLXNob3cnKTt9fSk7IC8vIGNsb3NlIG1vZGFsIGlmIGNsaWNrIG91dHNpZGUgb2YgaXRcblxuICBmdW5jdGlvbiBfYnVpbGRNb2RhbChlKSB7XG4gICAgaWYoZS50YXJnZXQgIT09IGUuY3VycmVudFRhcmdldCAmJiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Blb3BsZS1saXN0X192YWx1ZScpKSB7XG4gICAgICBpZiAoZS50YXJnZXQuZGF0YXNldC5uYW1lKSB7XG4gICAgICAgIF9yZW5kZXJQZXJzb25EYXRhKGUudGFyZ2V0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9yZW5kZXJQbGFuZXREYXRhKGUudGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZW5kZXJQZXJzb25EYXRhKHRhcmdldCkge1xuICAgIHBlb3BsZURhdGFMb2NhbC5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbikge1xuICAgICAgaWYgKHBlcnNvbi5uYW1lID09PSB0YXJnZXQuZGF0YXNldC5uYW1lKSB7XG4gICAgICAgIHZhciBpbWdDbGFzcyA9ICdtb2RhbF9fc2lkZS1pbWctLXBlb3BsZSc7XG4gICAgICAgIHZhciB0aXRsZSA9IHBlcnNvbi5uYW1lO1xuICAgICAgICB2YXIgc3VidGl0bGUgPSAnUGxhbmV0PC9zcGFuPjxzcGFuIGRhdGEtcGxhbmV0PVwiJyArIHBlcnNvbi5wbGFuZXROYW1lICsgJ1wiIGNsYXNzPVwibW9kYWxfX2NhcmQtc3VidGl0bGUgbW9kYWxfX2NhcmQtcGxhbmV0XCI+JyArIHBlcnNvbi5wbGFuZXROYW1lO1xuICAgICAgICB2YXIgZGF0YUxpc3QgPSBfZ2V0RGF0YUxpc3RIVE1MKHtrZXk6J0lEOicsIHZhbHVlOnBlcnNvbi5pZH0sIHtrZXk6J0dlbmRlcjonLCB2YWx1ZTpwZXJzb24uZ2VuZGVyfSx7a2V5OidCaXJ0aCBZZWFyOicsIHZhbHVlOnBlcnNvbi5iaXJ0aF95ZWFyfSx7a2V5OidIZWlnaHQ6JywgdmFsdWU6cGVyc29uLmhlaWdodCArICcgY20nfSwge2tleTonTWFzczonLCB2YWx1ZTogcGVyc29uLm1hc3MgKyAnIEtnJ30pO1xuXG4gICAgICAgIG1vZGFsLmlubmVySFRNTCA9IF9nZXRNb2RhbEhUTUwoaW1nQ2xhc3MsIHRpdGxlLCBzdWJ0aXRsZSwgZGF0YUxpc3QpO1xuICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbC1zaG93Jyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVuZGVyUGxhbmV0RGF0YSh0YXJnZXQpIHtcbiAgICBwbGFuZXREYXRhTG9jYWwuZm9yRWFjaChmdW5jdGlvbihwbGFuZXQpIHtcbiAgICAgIGlmIChwbGFuZXQubmFtZSA9PT0gdGFyZ2V0LmRhdGFzZXQucGxhbmV0KSB7XG4gICAgICAgIHZhciBpbWdDbGFzcyA9ICdtb2RhbF9fc2lkZS1pbWctLXBsYW5ldCc7XG4gICAgICAgIHZhciB0aXRsZSA9IHBsYW5ldC5uYW1lO1xuICAgICAgICB2YXIgc3VidGl0bGUgPSAnJztcbiAgICAgICAgdmFyIGRhdGFMaXN0ID0gX2dldERhdGFMaXN0SFRNTCh7a2V5OidJRDonLCB2YWx1ZTpwbGFuZXQuaWR9LCB7a2V5OidUZXJyYWluOicsIHZhbHVlOnBsYW5ldC50ZXJyYWlufSx7a2V5OidQb3B1bGF0aW9uOicsIHZhbHVlOnBsYW5ldC5wb3B1bGF0aW9ufSx7a2V5OidEaWFtZXRlcjonLCB2YWx1ZTpwbGFuZXQuZGlhbWV0ZXIgKyAnIEttJ30sIHtrZXk6J1Jlc2lkZW50czonLCB2YWx1ZTogcGxhbmV0LnJlc2lkZW50c05hbWVzfSk7XG5cbiAgICAgICAgbW9kYWwuaW5uZXJIVE1MID0gX2dldE1vZGFsSFRNTChpbWdDbGFzcywgdGl0bGUsIHN1YnRpdGxlLCBkYXRhTGlzdCk7XG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ21vZGFsLXNob3cnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRNb2RhbEhUTUwoaW1nQ2xhc3MsIHRpdGxlLCBzdWJ0aXRsZSwgZGF0YUxpc3QpIHtcbiAgICB2YXIgbW9kYWxIVE1MID0gJzxkaXYgY2xhc3M9XCJtb2RhbF9fY2FyZFwiPjxkaXYgY2xhc3M9XCJtb2RhbF9fY2xvc2UtYnRuXCI+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19zaWRlLWltZyAnICsgaW1nQ2xhc3MgKyAnXCI+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19jYXJkLWluZm9cIj48ZGl2IGNsYXNzPVwibW9kYWxfX2NhcmQtc3ViamVjdFwiPjxwIGNsYXNzPVwibW9kYWxfX2NhcmQtdGl0bGVcIj4nICsgdGl0bGUgKyAnPC9wPjxzcGFuIGNsYXNzPVwibW9kYWxfX2NhcmQtc3VidGl0bGVcIj4nICsgc3VidGl0bGUgKyAnPC9zcGFuPjwvZGl2Pjx1bCBjbGFzcz1cIm1vZGFsX19pbmZvLWdyaWRcIj4nICsgZGF0YUxpc3QgKyAnPC91bD48L2Rpdj48L2Rpdj4nO1xuICAgIHJldHVybiBtb2RhbEhUTUw7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RGF0YUxpc3RIVE1MKCl7XG4gICAgdmFyIGRhdGFMaXN0ID0gJyc7XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuICAgICAgZGF0YUxpc3QgKz0gICc8bGkgY2xhc3M9XCJtb2RhbF9faW5mby1pdGVtXCI+PHNwYW4gY2xhc3M9XCJtb2RhbF9faW5mby1pdGVtLWtleVwiPicgKyBlbC5rZXkgKyAnPC9zcGFuPjxzcGFuIGNsYXNzPVwibW9kYWxfX2luZm8taXRlbS12YWx1ZVwiPicgKyBlbC52YWx1ZSArICc8L3NwYW4+PC9saT4nO1xuICAgIH0pO1xuICAgIHJldHVybiBkYXRhTGlzdDtcbiAgfVxuXG4gIC8vIGV2ZW50IGRlbGVnYXRpb24gdG8gdGhlIG5ldyBkaXYgaW5zaWRlIG1vZGFsXG4gIGZ1bmN0aW9uIF9jbG9zZU1vZGFsKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ0blwiKSkge1xuICAgICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWwtc2hvdycpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9vcGVuUGxhbmV0TW9kYWwoZSkge1xuICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fY2FyZC1wbGFuZXRcIikpIHtcbiAgICAgIF9yZW5kZXJQbGFuZXREYXRhKGUudGFyZ2V0KTtcbiAgICB9XG4gIH1cbn0pKCk7XG4iLCJ2YXIgcmVuZGVyTGlzdCA9IChmdW5jdGlvbigpIHtcbiAgdmFyIHBlb3BsZUxpICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGVvcGxlLWxpc3RfX2l0ZW0nKTtcblxuICB2YXIgcGVvcGxlVVJMID0gJ2h0dHBzOi8vc3dhcGkuY28vYXBpL3Blb3BsZS8nO1xuICB2YXIgcHJvbWlzZXMgPSBbXTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbigpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgbG9hZEdpZi5jbGFzc0xpc3QuYWRkKCdsb2FkLXNjcmVlbl9faW1nLS1tb3ZlaW4nKTtcbiAgICB9LCAyMDApO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBsb2FkQmFsbG9vbkltZy5jbGFzc0xpc3QuYWRkKCdsb2FkLXNjcmVlbl9fYmFsbG9vbi0tc2hvdycpO1xuICAgIH0sIDIyMDApO1xuICB9KTtcblxuICByZXF1ZXN0U1dJbmZvKHBlb3BsZVVSTCwgXCJHRVRcIikudGhlbihfc3RhcnRMaXN0LCBlcnJvckhhbmRsZXIpO1xuXG4gIGZ1bmN0aW9uIF9zdGFydExpc3QoZGF0YSkge1xuICAgIHZhciBwZW9wbGVOdW1iZXIgPSBkYXRhLmNvdW50O1xuICAgIF9idWlsZExpc3QocGVvcGxlTnVtYmVyKTtcbiAgICBfcG9wdWxhdGVMaXN0KHBlb3BsZU51bWJlcik7XG4gIH1cblxuICBmdW5jdGlvbiBfYnVpbGRMaXN0KHBlb3BsZU51bWJlcikge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcGVvcGxlTnVtYmVyOyBpKz0yKSB7XG4gICAgICB2YXIgcGVvcGxlTGlDbG9uZSA9IHBlb3BsZUxpLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIHBlb3BsZUdyaWQuYXBwZW5kQ2hpbGQocGVvcGxlTGlDbG9uZSk7XG4gICAgfVxuICAgIHBlb3BsZU5hbWUgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVvcGxlLWxpc3RfX25hbWUnKTtcbiAgICBwZW9wbGVXcmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlb3BsZS1saXN0X19pdGVtLXdyYXBwZXInKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9wb3B1bGF0ZUxpc3QocGVvcGxlTnVtYmVyKSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gcGVvcGxlTnVtYmVyOyBpKyspIHtcbiAgICAgIGN1cnJlbnRQZXJzb25VUkwgPSBwZW9wbGVVUkwgKyBpO1xuICAgICAgcHJvbWlzZXMucHVzaChyZXF1ZXN0U1dJbmZvKGN1cnJlbnRQZXJzb25VUkwsIFwiR0VUXCIpKTtcbiAgICB9XG4gICAgUHJvbWlzZS5hbGwocHJvbWlzZXMubWFwKHJlZmxlY3QpKS50aGVuKGZ1bmN0aW9uKHBlb3BsZURhdGEpe1xuICAgICAgX3N0b3JlUGVvcGxlRGF0YShwZW9wbGVEYXRhKTtcbiAgICAgIHJlbmRlclBlcnNvbkl0ZW0oKTtcbiAgICAgIGdldFBsYW5ldERhdGEoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zdG9yZVBlb3BsZURhdGEocGVvcGxlRGF0YSkge1xuICAgIHZhciBpZCA9IDE7XG4gICAgcGVvcGxlRGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbkRhdGEpIHtcbiAgICAgIGlmIChwZXJzb25EYXRhLnJlc29sdmVkKSB7XG4gICAgICAgIHZhciBuZXdQZXJzb24gPSB7XG4gICAgICAgICAgaWQgICAgICAgICA6IGlkLFxuICAgICAgICAgIG5hbWUgICAgICAgOiBwZXJzb25EYXRhLnJlc29sdmVkLm5hbWUsXG4gICAgICAgICAgaGVpZ2h0ICAgICA6IHBlcnNvbkRhdGEucmVzb2x2ZWQuaGVpZ2h0LFxuICAgICAgICAgIG1hc3MgICAgICAgOiBwZXJzb25EYXRhLnJlc29sdmVkLm1hc3MsXG4gICAgICAgICAgYmlydGhfeWVhciA6IHBlcnNvbkRhdGEucmVzb2x2ZWQuYmlydGhfeWVhcixcbiAgICAgICAgICBnZW5kZXIgICAgIDogcGVyc29uRGF0YS5yZXNvbHZlZC5nZW5kZXJcbiAgICAgICAgfTtcbiAgICAgICAgcGVyc29uRGF0YS5yZXNvbHZlZC5ob21ld29ybGQgP1xuICAgICAgICBuZXdQZXJzb24ucGxhbmV0ID0gcGVyc29uRGF0YS5yZXNvbHZlZC5ob21ld29ybGQucmVwbGFjZSgvW14wLTldL2csJycpIDpcbiAgICAgICAgbmV3UGVyc29uLnBsYW5ldCA9IFwiVW5rbm93blwiO1xuXG4gICAgICAgIHBlcnNvbkRhdGEucmVzb2x2ZWQuc3BlY2llc1swXSA/XG4gICAgICAgIG5ld1BlcnNvbi5zcGVjaWVzID0gcGVyc29uRGF0YS5yZXNvbHZlZC5zcGVjaWVzWzBdLnJlcGxhY2UoL1teMC05XS9nLCcnKSA6XG4gICAgICAgIG5ld1BlcnNvbi5zcGVjaWVzID0gXCJVbmtub3duXCI7XG5cbiAgICAgICAgcGVvcGxlRGF0YUxvY2FsLnB1c2gobmV3UGVyc29uKTtcbiAgICAgIH1cbiAgICAgIGlkKys7XG4gICAgfSk7XG4gIH1cbn0pKCk7XG4iLCJ2YXIgc2VhcmNoICA9IChmdW5jdGlvbigpIHtcbiAgdmFyIHBsYW5ldE5hbWUgID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlb3BsZS1saXN0X19wbGFuZXQnKTtcblxuICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBfZmlsdGVyTWF0Y2hlcyk7XG4gIHNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgX2ZpbHRlck1hdGNoZXMpO1xuXG4gIGZ1bmN0aW9uIF9maWx0ZXJNYXRjaGVzKCkge1xuICAgIHRlcm0gPSBzZWFyY2hJbnB1dC52YWx1ZTtcbiAgICB2YXIgbWF0Y2hGbGFnID0gMDtcbiAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKHRlcm0sICdnaScpO1xuICAgIHBlb3BsZVdyYXBwZXIuZm9yRWFjaChmdW5jdGlvbihwZXJzb25XcmFwcGVyKSB7XG4gICAgICBpZihwZXJzb25XcmFwcGVyLmNoaWxkcmVuWzBdLmRhdGFzZXQubmFtZSkge1xuICAgICAgICBpZiAocGVyc29uV3JhcHBlci5jaGlsZHJlblswXS5kYXRhc2V0Lm5hbWUubWF0Y2gocmVnZXgpIHx8IHBlcnNvbldyYXBwZXIuY2hpbGRyZW5bMV0uZGF0YXNldC5wbGFuZXQubWF0Y2gocmVnZXgpKSB7XG4gICAgICAgICAgbWF0Y2hGbGFnKys7XG4gICAgICAgICAgICBwZXJzb25XcmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Blb3BsZS1saXN0X19pdGVtLXdyYXBwZXItLXNob3cnKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHBlcnNvbldyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tZmFkZScpO1xuICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHBlcnNvbldyYXBwZXIuY2xhc3NMaXN0LmFkZCgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tZmFkZScpO1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBlcnNvbldyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgncGVvcGxlLWxpc3RfX2l0ZW0td3JhcHBlci0tc2hvdycpO1xuICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBtYXRjaEZsYWcgPT09IDAgPyBzZWFyY2hJbnB1dC5jbGFzc0xpc3QuYWRkKCdoZWFkZXJfX2lucHV0LS1uby1yZXN1bHRzJykgOiBzZWFyY2hJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoZWFkZXJfX2lucHV0LS1uby1yZXN1bHRzJylcbiAgfVxufSkoKTtcbiIsInZhciBzb3J0UGVvcGxlID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgc2VjdFR5cGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19zZWxlY3QnKTtcblxuICBzZWN0VHlwZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBfc29ydFBlb3BsZURhdGFMb2NhbCk7XG5cbiAgZnVuY3Rpb24gX3NvcnRQZW9wbGVEYXRhTG9jYWwoKSB7XG4gICAgX3NvcnRCeShzZWN0VHlwZS52YWx1ZSk7XG4gICAgcmVuZGVyUGVyc29uSXRlbSgpO1xuICAgIHJlbmRlclBsYW5ldEl0ZW0oKTtcblxuICAgIGZ1bmN0aW9uIF9zb3J0QnkocHJvcGVydHkpIHtcbiAgICAgIHBlb3BsZURhdGFMb2NhbC5zb3J0KGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICBpZihhW3Byb3BlcnR5XSA8IGJbcHJvcGVydHldKSByZXR1cm4gLTE7XG4gICAgICAgIGlmKGFbcHJvcGVydHldID4gYltwcm9wZXJ0eV0pIHJldHVybiAxO1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSkoKTtcblxuIl19
